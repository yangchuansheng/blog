<!doctype html><html lang=zh-cn dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Tailscale 基础教程：部署私有 DERP 中继服务器 &#183; 云原生实验室</title>
<meta name=title content="Tailscale 基础教程：部署私有 DERP 中继服务器 &#183; 云原生实验室"><meta name=description content="本文给大家介绍了 STUN 对于辅助 NAT 穿透的意义，科普了几种常见的中继协议，包含 Tailscale 自研的 DERP 协议。最后手把手教大家如何自建私有的 DERP 服务器，并让 Tailscale 使用我们自建的 DERP 服务器。"><meta name=keywords content="WireGuard,Tailscale,Headscale,"><link rel=canonical href=https://icloudnative.io/posts/custom-derp-servers/><link type=text/css rel=stylesheet href=/css/main.bundle.min.501e1157e1da0e896a0dacc28f180b47b81a05c900088c4f67646f6dc3f41734eeaee4e94e383ea4a753234726d51516f8fa233b7652a96784ada3a21f9e0299.css integrity="sha512-UB4RV+HaDolqDazCjxgLR7gaBckACIxPZ2RvbcP0FzTuruTpTjg+pKdTI0cm1RUW+PojO3ZSqWeEraOiH54CmQ=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.447fa6723e45b14dd799293ce1f73c943400f0cd304e2dd6ccea0838024db59e8663389376147b5b5234ef959a5d51df04278c002fd4f1b84eb0fdfc75c7cbcc.js integrity="sha512-RH+mcj5FsU3XmSk84fc8lDQA8M0wTi3WzOoIOAJNtZ6GYziTdhR7W1I075WaXVHfBCeMAC/U8bhOsP38dcfLzA==" data-copy=复制 data-copied=复制成功！></script><script src=/js/zoom.min.js></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Tailscale 基础教程：部署私有 DERP 中继服务器"><meta property="og:description" content="本文给大家介绍了 STUN 对于辅助 NAT 穿透的意义，科普了几种常见的中继协议，包含 Tailscale 自研的 DERP 协议。最后手把手教大家如何自建私有的 DERP 服务器，并让 Tailscale 使用我们自建的 DERP 服务器。"><meta property="og:type" content="article"><meta property="og:url" content="https://icloudnative.io/posts/custom-derp-servers/"><meta property="og:image" content="https://icloudnative.io/posts/custom-derp-servers/featured.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-27T09:06:37+08:00"><meta property="article:modified_time" content="2022-03-27T09:06:37+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://icloudnative.io/posts/custom-derp-servers/featured.jpg"><meta name=twitter:title content="Tailscale 基础教程：部署私有 DERP 中继服务器"><meta name=twitter:description content="本文给大家介绍了 STUN 对于辅助 NAT 穿透的意义，科普了几种常见的中继协议，包含 Tailscale 自研的 DERP 协议。最后手把手教大家如何自建私有的 DERP 服务器，并让 Tailscale 使用我们自建的 DERP 服务器。"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"博客","name":"Tailscale 基础教程：部署私有 DERP 中继服务器","headline":"Tailscale 基础教程：部署私有 DERP 中继服务器","description":"本文给大家介绍了 STUN 对于辅助 NAT 穿透的意义，科普了几种常见的中继协议，包含 Tailscale 自研的 DERP 协议。最后手把手教大家如何自建私有的 DERP 服务器，并让 Tailscale 使用我们自建的 DERP 服务器。","abstract":"上篇文章介绍了如何使用 Headscale 替代 Tailscale 官方的控制服务器，并接入各个平","inLanguage":"zh-cn","url":"https:\/\/icloudnative.io\/posts\/custom-derp-servers\/","author":{"@type":"Person","name":"米开朗基杨"},"copyrightYear":"2022","dateCreated":"2022-03-27T09:06:37\u002b08:00","datePublished":"2022-03-27T09:06:37\u002b08:00","dateModified":"2022-03-27T09:06:37\u002b08:00","keywords":["Headscale","Tailscale","WireGuard","DERP","STUN","TURN","Full Mesh","VPN"],"mainEntityOfPage":"true","wordCount":"5939"}]</script><meta name=author content="米开朗基杨"><link href=/index.xml rel=me><link href=https://twitter.com/CarsonYangk8s rel=me><link href=https://images.icloudnative.io/uPic/tmpm1ykjt96.webp rel=me><link href=https://github.com/yangchuansheng rel=me><link href=https://t.me/cloudnativer rel=me><script src=/lib/jquery/jquery.slim.min.js integrity></script><script data-id=umami-script async src=https://umami.icloudnative.io/oishii data-website-id=f415abb1-1cb9-402e-a1c4-225ca9d792b0></script><script type=text/javascript>document.querySelector('script[data-id="umami-script"]').addEventListener("load",function(){const e=document.head.querySelector('meta[property = "og:type"]').getAttribute("content");let t=document.head.querySelector('meta[property = "og:title"]').getAttribute("content"),n=document.head.querySelector('meta[property = "og:url"]').getAttribute("content");umami.track(e+":"+t,{url:n})})</script><script>document.addEventListener("DOMContentLoaded",function(){var e=document.createElement("link");e.href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css",e.rel="stylesheet",document.head.appendChild(e)})</script><div id=fps style=z-index:999;position:fixed;bottom:3px;right:3px;color:#fff;font-size:10px></div><script defer type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/layer/3.5.1/layer.min.js></script><script defer type=text/javascript src=https://icloudnative.io/js/fps.js></script><script defer>window.addEventListener("scroll",function e(){window.scrollY>100&&(function(e,t,n,s){if(typeof e.webpushr!="undefined")return;e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var i=t.getElementsByTagName(n)[0],o=t.createElement(n);o.id=s,o.async=1,o.src="https://cdn.webpushr.com/app.min.js",i.parentNode.appendChild(o)}(window,document,"script","webpushr-jssdk"),webpushr("setup",{key:"BHIaDYldZcXlQt38kYXgH48NQZFQkowuo14rNhiIvrGEP5kFU5lb5h-VIMlUkjy-kxygxW4hEvb6GjijlYYlwCk"}),window.removeEventListener("scroll",e))})</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",e=>{const t="https://htr4n1.laf.run/baidu-seo?urls="+window.location.href;fetch(t).then(e=>e.json()).then(e=>{const t=JSON.parse(e.body);t.remain>0&&t.success===1?console.log("百度收录提交成功，当前api余剩次数："+t.remain):(t.remain===0?console.log("已达到今日百度提交上限。"):(console.log(t.remain),console.log("api提交失败")),t.not_same_site&&console.log("未收录的站点：",t.not_same_site.join(", ")))}).catch(e=>{console.error("请求失败，但这可能是因为达到提交上限:",e)})})</script><script defer>function loadScriptOnScroll(){var e,t,n,s=window.scrollY||window.pageYOffset;s>100&&(n=n||[],e=document.createElement("script"),e.src="https://hm.baidu.com/hm.js?efe96f04908ae320df234a4f5626879e",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t),window.removeEventListener("scroll",loadScriptOnScroll))}window.addEventListener("scroll",loadScriptOnScroll)</script><script defer>function loadAnalyticsScript(){var e=document.createElement("script");e.async=!0,e.src="https://ga.icloudnative.io/gtag/js?id=G-0VHVXWXJMQ",document.head.appendChild(e),window.dataLayer=window.dataLayer||[];function t(){dataLayer.push(arguments)}t("js",new Date),t("config","G-0VHVXWXJMQ"),window.removeEventListener("scroll",onScrollLoadAnalytics)}function onScrollLoadAnalytics(){window.scrollY>100&&loadAnalyticsScript()}window.addEventListener("scroll",onScrollLoadAnalytics)</script><script defer>function loadClarityScript(){(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","m535olg9md"),window.removeEventListener("scroll",onScrollLoadClarity)}function onScrollLoadClarity(){window.scrollY>100&&loadClarityScript()}window.addEventListener("scroll",onScrollLoadClarity)</script><div class=top-scroll-bar style=height:5px;background-color:blue;width:0;position:fixed;top:0;z-index:100></div><script type=text/javascript>$(document).ready(function(){$(window).scroll(function(){$(".top-scroll-bar").attr("style","width: "+$(this).scrollTop()/($(document).height()-$(this).height())*100+"%; display: block;")})})</script><script src=https://cdn.jsdelivr.net/gh/instantpage/instant.page@master/instantpage.js type=module></script><script type=text/javascript>var OriginTitile=document.title,titleTime;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="你别走吖 Σ(っ °Д °;)っ",clearTimeout(titleTime)):(document.title="你可算回来了 (｡•ˇ‸ˇ•｡)"+OriginTitile,titleTime=setTimeout(function(){document.title=OriginTitile},2e3))})</script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>跳过正文</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px]" style=z-index:100><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div><a href=/ class=flex><img src=/img/logo.webp width=256 height=256 class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt=云原生实验室></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900"><h6 style=font-size:1.5rem><span style=color:#23d18b>>$</span>&nbsp;cd /home/<span class=logo_cursor></span></h6></a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=/examples/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title=开源项目>项目</p></a><a href="https://umami.icloudnative.io/share/UuDHNJJWIShegM2N/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AE%9E%E9%AA%8C%E5%AE%A4?theme=dark" target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span><p class="text-base font-medium" title>实时访客</p></a><div><div class="cursor-pointer flex items-center nested-menu"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M159.3 5.4c7.8-7.3 19.9-7.2 27.7.1 27.6 25.9 53.5 53.8 77.7 84 11-14.4 23.5-30.1 37-42.9 7.9-7.4 20.1-7.4 28 .1 34.6 33 63.9 76.6 84.5 118 20.3 40.8 33.8 82.5 33.8 111.9C448 404.2 348.2 512 224 512 98.4 512 0 404.1.0 276.5c0-38.4 17.8-85.3 45.4-131.7C73.3 97.7 112.7 48.6 159.3 5.4zM225.7 416c25.3.0 47.7-7 68.8-21 42.1-29.4 53.4-88.2 28.1-134.4-2.8-5.6-5.6-11.2-9.8-16.8l-50.6 58.8S180.8 199 175.1 192c-42 51.8-63.1 81.2-63.1 114.8C112 375.4 162.6 416 225.7 416z"/></svg></span></span><a class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title>百宝箱
</a><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=https://icloudnative.io/uptime-status/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M228.3 469.1 47.6 300.4c-4.2-3.9-8.2-8.1-11.9-12.4h87c22.6.0 43-13.6 51.7-34.5l10.5-25.2 49.3 109.5c3.8 8.5 12.1 14 21.4 14.1s17.8-5 22-13.3L320 253.7l1.7 3.4c9.5 19 28.9 31 50.1 31H476.3c-3.7 4.3-7.7 8.5-11.9 12.4L283.7 469.1c-7.5 7-17.4 10.9-27.7 10.9s-20.2-3.9-27.7-10.9zM503.7 240h-132c-3 0-5.8-1.7-7.2-4.4l-23.2-46.3c-4.1-8.1-12.4-13.3-21.5-13.3s-17.4 5.1-21.5 13.3l-41.4 82.8-51-113.9c-3.9-8.7-12.7-14.3-22.2-14.1s-18.1 5.9-21.8 14.8l-31.8 76.3c-1.2 3-4.2 4.9-7.4 4.9H16c-2.6.0-5 .4-7.3 1.1-5.7-16-8.7-33-8.7-50.3v-5.8c0-69.9 50.5-129.5 119.4-141C165 36.5 211.4 51.4 244 84l12 12 12-12c32.6-32.6 79-47.5 124.6-39.9C461.5 55.6 512 115.2 512 185.1v5.8c0 16.9-2.8 33.5-8.3 49.1z"/></svg></span></span><p class="text-sm font-sm" title>服务监控</p></a><a href=https://privatebin.icloudnative.io/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M160 0c-23.7.0-44.4 12.9-55.4 32H48C21.5 32 0 53.5.0 80V4e2c0 26.5 21.5 48 48 48H192V176c0-44.2 35.8-80 80-80h48V80c0-26.5-21.5-48-48-48H215.4C204.4 12.9 183.7.0 160 0zM272 128c-26.5.0-48 21.5-48 48V448v16c0 26.5 21.5 48 48 48H464c26.5.0 48-21.5 48-48V256H416c-17.7.0-32-14.3-32-32V128H320 272zM160 40a24 24 0 110 48 24 24 0 110-48zm256 88v96h96l-96-96z"/></svg></span></span><p class="text-sm font-sm" title>共享文本</p></a><a href=/jstc/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M0 96C0 60.7 28.7 32 64 32H448c35.3.0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H64c-35.3.0-64-28.7-64-64V96zM323.8 202.5c-4.5-6.6-11.9-10.5-19.8-10.5s-15.4 3.9-19.8 10.5l-87 127.6L170.7 297c-4.6-5.7-11.5-9-18.7-9s-14.2 3.3-18.7 9l-64 80c-5.8 7.2-6.9 17.1-2.9 25.4S78.8 416 88 416h96 32H424c8.9.0 17.1-4.9 21.2-12.8s3.6-17.4-1.4-24.7l-120-176zM112 192c26.5.0 48-21.5 48-48s-21.5-48-48-48-48 21.5-48 48 21.5 48 48 48z"/></svg></span></span><p class="text-sm font-sm" title>趣味截图</p></a></div></div></div></div><a href=/index.xml class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 64C0 46.3 14.3 32 32 32c229.8.0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7.0 64zM128 416c0 35.3-28.7 64-64 64S0 451.3.0 416s28.7-64 64-64 64 28.7 64 64zM32 160c159.1.0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7.0-32-14.3-32-32s14.3-32 32-32z"/></svg></span></span><p class="text-base font-medium" title=rss></p></a><a href=https://twitter.com/CarsonYangk8s target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span><p class="text-base font-medium" title=twitter></p></a><a href=https://github.com/yangchuansheng target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title=github></p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400" style=margin-right:5px><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/examples/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div class=mr-2><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></div><p class="text-bg font-bg" title=开源项目>项目</p></a></li><li class=mt-1><a href="https://umami.icloudnative.io/share/UuDHNJJWIShegM2N/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AE%9E%E9%AA%8C%E5%AE%A4?theme=dark" target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div class=mr-2><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></div><p class="text-bg font-bg" title>实时访客</p></a></li><li class=mt-1><a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M159.3 5.4c7.8-7.3 19.9-7.2 27.7.1 27.6 25.9 53.5 53.8 77.7 84 11-14.4 23.5-30.1 37-42.9 7.9-7.4 20.1-7.4 28 .1 34.6 33 63.9 76.6 84.5 118 20.3 40.8 33.8 82.5 33.8 111.9C448 404.2 348.2 512 224 512 98.4 512 0 404.1.0 276.5c0-38.4 17.8-85.3 45.4-131.7C73.3 97.7 112.7 48.6 159.3 5.4zM225.7 416c25.3.0 47.7-7 68.8-21 42.1-29.4 53.4-88.2 28.1-134.4-2.8-5.6-5.6-11.2-9.8-16.8l-50.6 58.8S180.8 199 175.1 192c-42 51.8-63.1 81.2-63.1 114.8C112 375.4 162.6 416 225.7 416z"/></svg></span></span><p class="text-bg font-bg" title>百宝箱</p><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></a></li><li class=mt-1><a href=https://icloudnative.io/uptime-status/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M228.3 469.1 47.6 300.4c-4.2-3.9-8.2-8.1-11.9-12.4h87c22.6.0 43-13.6 51.7-34.5l10.5-25.2 49.3 109.5c3.8 8.5 12.1 14 21.4 14.1s17.8-5 22-13.3L320 253.7l1.7 3.4c9.5 19 28.9 31 50.1 31H476.3c-3.7 4.3-7.7 8.5-11.9 12.4L283.7 469.1c-7.5 7-17.4 10.9-27.7 10.9s-20.2-3.9-27.7-10.9zM503.7 240h-132c-3 0-5.8-1.7-7.2-4.4l-23.2-46.3c-4.1-8.1-12.4-13.3-21.5-13.3s-17.4 5.1-21.5 13.3l-41.4 82.8-51-113.9c-3.9-8.7-12.7-14.3-22.2-14.1s-18.1 5.9-21.8 14.8l-31.8 76.3c-1.2 3-4.2 4.9-7.4 4.9H16c-2.6.0-5 .4-7.3 1.1-5.7-16-8.7-33-8.7-50.3v-5.8c0-69.9 50.5-129.5 119.4-141C165 36.5 211.4 51.4 244 84l12 12 12-12c32.6-32.6 79-47.5 124.6-39.9C461.5 55.6 512 115.2 512 185.1v5.8c0 16.9-2.8 33.5-8.3 49.1z"/></svg></span></span><p class="text-sm font-small" title>服务监控</p></a></li><li class=mt-1><a href=https://privatebin.icloudnative.io/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M160 0c-23.7.0-44.4 12.9-55.4 32H48C21.5 32 0 53.5.0 80V4e2c0 26.5 21.5 48 48 48H192V176c0-44.2 35.8-80 80-80h48V80c0-26.5-21.5-48-48-48H215.4C204.4 12.9 183.7.0 160 0zM272 128c-26.5.0-48 21.5-48 48V448v16c0 26.5 21.5 48 48 48H464c26.5.0 48-21.5 48-48V256H416c-17.7.0-32-14.3-32-32V128H320 272zM160 40a24 24 0 110 48 24 24 0 110-48zm256 88v96h96l-96-96z"/></svg></span></span><p class="text-sm font-small" title>共享文本</p></a></li><li class=mt-1><a href=/jstc/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M0 96C0 60.7 28.7 32 64 32H448c35.3.0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H64c-35.3.0-64-28.7-64-64V96zM323.8 202.5c-4.5-6.6-11.9-10.5-19.8-10.5s-15.4 3.9-19.8 10.5l-87 127.6L170.7 297c-4.6-5.7-11.5-9-18.7-9s-14.2 3.3-18.7 9l-64 80c-5.8 7.2-6.9 17.1-2.9 25.4S78.8 416 88 416h96 32H424c8.9.0 17.1-4.9 21.2-12.8s3.6-17.4-1.4-24.7l-120-176zM112 192c26.5.0 48-21.5 48-48s-21.5-48-48-48-48 21.5-48 48 21.5 48 48 48z"/></svg></span></span><p class="text-sm font-small" title>趣味截图</p></a></li><li class=mb-2></li><li class=mt-1><a href=/index.xml class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 64C0 46.3 14.3 32 32 32c229.8.0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7.0 64zM128 416c0 35.3-28.7 64-64 64S0 451.3.0 416s28.7-64 64-64 64 28.7 64 64zM32 160c159.1.0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7.0-32-14.3-32-32s14.3-32 32-32z"/></svg></span></div><p class="text-bg font-bg" title=rss></p></a></li><li class=mt-1><a href=https://twitter.com/CarsonYangk8s target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></div><p class="text-bg font-bg" title=twitter></p></a></li><li class=mt-1><a href=https://github.com/yangchuansheng target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></div><p class="text-bg font-bg" title=github></p></a></li></ul></div></label></div></div><script>(function(){var e=$(".main-menu"),t=window.location.pathname;e.find('a[href="'+t+'"]').each(function(e,t){$(t).children("p").addClass("active")})})()</script></div></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("menu-blur");n.style.opacity=t/300})</script><div class="relative flex flex-col grow"><div class=wrapper__left style=left:2px data-pad=true dir=ltr><div class="join-us dark:text-black" style=margin-top:3%;height:39%><picture><source media="(max-width: 767px)" srcset><img class="modalImage nozoom" style=max-width:13%;height:auto src=/img/sealos-logo.png alt=icon></img></picture><p><a data-umami-event=Sealos href=https://github.com/labring/sealos target=_blank>Sealos</a>，在云桌面中运行分布式应用程序，像使用个人电脑一样使用云</p><picture><source media="(max-width: 767px)" srcset><img class=modalImage style=max-width:80%;height:auto src=/img/sealos-desktop.webp alt=icon></img></picture><p style=margin-top:1rem!important;text-align:center><a data-umami-event=Sealos class="!rounded-md bg-primary-600 px-4 py-2 !text-neutral !no-underline hover:!bg-primary-500 dark:bg-primary-800 dark:hover:!bg-primary-700" href=https://sealos.run target=_blank role=button>去看看👀</a></p></div><div class=join-us style=top:42%;height:53%><picture><source media="(max-width: 767px)" srcset><img class="modalImage nozoom" id=modalImage src=/img/modal-content.svg alt=icon></img></picture><p>扫码加入微信群，和云原生大佬们一起探讨云原生和不可描述的事情！</p><div><picture><source media="(max-width: 767px)" srcset><img class=modalImage style=width:25%;height:auto;margin-top:2% src=/img/wechat-qr-code.jpg alt="wechat qr code"></img></picture></div><button class=button_left>
<a data-umami-event="Telegram cloud_native_share" href=https://t.me/cloudnativer target=_blank title="Telegram cloud_native_share"><div class=icon_left><svg viewBox="0 0 16 16" class="bi bi-telegram" fill="currentcolor" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M16 8A8 8 0 110 8a8 8 0 0116 0zM8.287 5.906c-.778.324-2.334.994-4.666 2.01-.378.15-.577.298-.595.442-.03.243.275.339.69.47l.175.055c.408.133.958.288 1.243.294.26.006.549-.1.868-.32 2.179-1.471 3.304-2.214 3.374-2.23.05-.012.12-.026.166.016.047.041.042.12.037.141-.03.129-1.227 1.241-1.846 1.817-.193.18-.33.307-.358.336a8.154 8.154.0 01-.188.186c-.38.366-.664.64.015 1.088.327.216.589.393.85.571.284.194.568.387.936.629.093.06.183.125.27.187.331.236.63.448.997.414.214-.02.435-.22.547-.82.265-1.417.786-4.486.906-5.751a1.426 1.426.0 00-.013-.315.337.337.0 00-.114-.217.526.526.0 00-.31-.093c-.3.005-.763.166-2.984 1.09z"/></svg></div></a><p>加入 Telegram</p></button>
<button class=button_left>
<a data-umami-event="Telegram cloud_native_share" href=https://t.me/cloud_native_share target=_blank title="Telegram cloud_native_share"><div class=icon_left><svg viewBox="0 0 16 16" class="bi bi-telegram" fill="currentcolor" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M16 8A8 8 0 110 8a8 8 0 0116 0zM8.287 5.906c-.778.324-2.334.994-4.666 2.01-.378.15-.577.298-.595.442-.03.243.275.339.69.47l.175.055c.408.133.958.288 1.243.294.26.006.549-.1.868-.32 2.179-1.471 3.304-2.214 3.374-2.23.05-.012.12-.026.166.016.047.041.042.12.037.141-.03.129-1.227 1.241-1.846 1.817-.193.18-.33.307-.358.336a8.154 8.154.0 01-.188.186c-.38.366-.664.64.015 1.088.327.216.589.393.85.571.284.194.568.387.936.629.093.06.183.125.27.187.331.236.63.448.997.414.214-.02.435-.22.547-.82.265-1.417.786-4.486.906-5.751a1.426 1.426.0 00-.013-.315.337.337.0 00-.114-.217.526.526.0 00-.31-.093c-.3.005-.763.166-2.984 1.09z"/></svg></div></a><p>黑科技广播站</p></button>
<button class=button_left>
<a data-umami-event="Telegram cloud_native_blogs" href=https://t.me/cloud_native_blogs target=_blank title="Telegram cloud_native_blogs"><div class=icon_left><svg viewBox="0 0 16 16" class="bi bi-telegram" fill="currentcolor" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M16 8A8 8 0 110 8a8 8 0 0116 0zM8.287 5.906c-.778.324-2.334.994-4.666 2.01-.378.15-.577.298-.595.442-.03.243.275.339.69.47l.175.055c.408.133.958.288 1.243.294.26.006.549-.1.868-.32 2.179-1.471 3.304-2.214 3.374-2.23.05-.012.12-.026.166.016.047.041.042.12.037.141-.03.129-1.227 1.241-1.846 1.817-.193.18-.33.307-.358.336a8.154 8.154.0 01-.188.186c-.38.366-.664.64.015 1.088.327.216.589.393.85.571.284.194.568.387.936.629.093.06.183.125.27.187.331.236.63.448.997.414.214-.02.435-.22.547-.82.265-1.417.786-4.486.906-5.751a1.426 1.426.0 00-.013-.315.337.337.0 00-.114-.217.526.526.0 00-.31-.093c-.3.005-.763.166-2.984 1.09z"/></svg></div></a><p>高手博客收藏夹</p></button></div></div><div class=wrapper__right style=right:2px data-pad=true dir=ltr><div class="join-us dark:text-black" style=margin-top:3%;height:34%><svg style="display:inline-block" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentcolor"><path d="M773.12 757.76h-79.872c-15.36.0-29.696-15.36-29.696-29.696s15.36-29.696 29.696-29.696h79.872c100.352.0 180.224-79.872 180.224-180.224S873.472 337.92 773.12 337.92c-25.6.0-50.176 5.12-74.752 15.36-10.24 5.12-20.48 5.12-25.6.0-10.24-5.12-15.36-15.36-15.36-20.48-15.36-100.352-100.352-175.104-200.704-175.104C346.112 155.648 256 245.76 250.88 356.352c0 15.36-10.24 29.696-29.696 29.696-79.872 5.12-145.408 74.752-145.408 160.768.0 90.112 70.656 160.768 160.768 160.768h75.776c15.36.0 29.696 15.36 29.696 29.696S326.656 768 311.296 768h-79.872C110.592 757.76 10.24 662.528 10.24 541.696c0-105.472 75.776-195.584 175.104-216.064 15.36-130.048 130.048-235.52 266.24-235.52 120.832.0 225.28 79.872 256 195.584 20.48-5.12 45.056-10.24 65.536-10.24 135.168 1.024 240.64 111.616 240.64 241.664S903.168 757.76 773.12 757.76z"/><path d="M437.248 933.888c-10.24.0-15.36-5.12-20.48-10.24-10.24-10.24-10.24-29.696.0-45.056l79.872-79.872h-60.416c-10.24.0-25.6-5.12-29.696-20.48-5.12-10.24.0-24.576 5.12-34.816l130.048-130.048c10.24-10.24 29.696-10.24 45.056.0 10.24 10.24 10.24 29.696.0 45.056L512 742.4h55.296c10.24.0 24.576 5.12 29.696 20.48 5.12 10.24.0 24.576-5.12 34.816L461.824 928.768c-10.24 5.12-20.48 5.12-24.576 5.12z"/></svg>&nbsp;<div class=modalImage style=font-size:1.125rem!important><span>今日天气</span></div><div id=he-plugin-standard></div></div><script>WIDGET={CONFIG:{layout:"2",width:"290",height:"270",background:"3",dataColor:"FFFFFF",borderRadius:"5",key:"ea8d62655f2d45c5b34f5efdbec2fa8a"}}</script><script defer>document.addEventListener("DOMContentLoaded",function(){if(!window.matchMedia("(max-width: 768px)").matches){var e=document.createElement("script");e.src="https://widget.qweather.net/standard/static/js/he-standard-common.js?v=2.0",document.body.appendChild(e),setInterval(function(){var e,t=document.querySelectorAll("#he-plugin-standard img:not([alt])");t.forEach(function(e){e.alt="天气图标"}),e=document.querySelector('a[href="https://www.qweather.com"]'),e&&e.setAttribute("aria-label","访问和风天气网站")},1e3)}})</script><div id=tiangou class="join-us dark:text-black" style=top:36%><svg style="display:inline-block" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentcolor"><path d="M774.144 734.72c-35.328 60.416-99.84 93.696-176.64 74.752-1.024 29.696-12.288 54.784-36.352 72.704-15.36 11.264-33.28 16.896-51.712 15.872-47.616-1.536-75.264-30.72-85.504-88.064-74.752 15.36-132.608-8.704-173.056-72.192-17.92 3.584-35.84 9.216-53.76 10.752-63.488 5.12-107.52-28.16-122.88-90.112-12.288-49.152-7.68-98.816 5.12-146.944 34.304-130.048 102.4-238.08 213.504-315.392 146.944-102.912 333.312-93.184 471.552 24.576C865.792 307.2 928.768 416.768 952.832 547.84c6.144 34.816 6.656 70.144-1.024 104.96-20.48 94.72-100.864 110.592-166.4 86.016-3.584-.512-7.168-2.048-11.264-4.096zm-235.008-46.592c11.776 41.984 46.592 71.68 90.112 76.288 42.496 4.096 82.432-17.92 102.912-55.296 3.072-6.144 3.072-10.752.512-17.92-6.144-16.384-14.336-33.792-14.848-51.2-2.048-86.016-2.048-172.032-2.56-258.048.0-15.872 8.704-24.576 23.04-24.064 13.824.512 20.992 8.704 20.992 24.576l1.536 240.64c0 6.144.0 12.288.512 18.432 1.536 15.872 7.168 30.208 19.456 40.96 40.448 36.864 104.96 19.456 120.32-32.768 8.704-30.208 8.704-60.928 3.584-91.136-20.48-117.248-75.776-216.064-164.352-295.424-119.296-106.496-277.504-121.344-408.064-36.352-117.76 76.8-184.832 188.416-211.968 324.608-6.656 33.792-7.168 68.608 4.096 101.888 8.192 23.552 22.528 40.96 48.128 46.08 54.784 10.752 92.16-19.456 92.16-75.264V614.4c0-76.8.0-153.088.512-229.888.0-17.92 8.192-27.136 23.04-26.624 14.336.0 21.504 9.216 22.016 26.624.0 12.8-.512 25.6-.512 37.888.0 69.12-.512 138.24-.512 207.36.0 22.528-5.12 43.52-16.384 63.488-2.048 4.096-2.56 11.264-.512 15.36 29.696 59.904 111.104 75.264 160.768 30.72 16.384-14.848 28.16-32.256 32.256-50.688-14.336-13.312-26.624-25.088-39.424-36.864-15.36-14.336-17.92-31.744-12.288-50.688 5.632-19.968 19.456-33.792 39.424-35.84 25.6-2.56 51.712-2.048 77.312.0 19.456 1.536 32.256 15.36 38.4 33.792 5.632 16.896 5.632 33.792-7.168 47.616-11.776 14.336-26.624 26.624-42.496 41.472zm-50.176 85.504c-18.944 13.312-24.064 30.208-16.384 51.712 6.144 17.92 23.552 29.184 41.472 27.648 18.944-1.536 33.28-14.336 37.376-33.28 5.632-26.112 2.56-35.328-15.872-45.056-1.024 9.216-.512 18.944-2.56 27.648-2.56 10.24-11.264 14.848-21.504 14.848-15.36.512-19.968-8.192-22.528-43.52z"/><path d="M391.168 496.64c-20.992.0-37.376-16.896-36.864-37.376.512-20.48 17.92-36.864 38.4-36.352 19.968.512 35.84 16.896 35.84 37.376.512 20.48-15.872 36.352-37.376 36.352zm282.624-31.744c0 20.48-15.872 36.864-36.352 36.864-20.992.0-37.888-16.384-37.376-37.376.512-20.48 16.384-36.864 36.864-36.864 20.992-.512 36.864 15.872 36.864 37.376z"/></svg>&nbsp;<div class=modalImage style=font-size:1.125rem!important><span>舔狗日记</span></div><p id=apiData class="content type3"></p><div class=change><svg id="refreshButton" class="modalImage" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentcolor"><path d="M1000.61 625.5c-24.6-33.4-55.3-155.5-69.3-231.5-3.8-20.6-18.7-36.9-38.8-42.6-4-1.1-8.1-1.8-12.2-1.9-35.3-59-74.5-66.7-100.5-71.8-18.5-3.6-18.8-4.5-21.5-11.1-13.1-32.1-32.3-54-57.1-65.1-20.8-9.4-41.4-9.2-53.7-9.2-.9.0-2-.2-3.2-.5-.8-.2-1.6-.3-2.4-.4-39.3-56.7-70.7-68.1-108.5-68.1h-.2c-38.1.0-63 21-81.2 36.4l-1.6 1.4c-21.3 18-24.9 18.8-33.7 15.2-45.3-18.6-84.6-8.1-116.8 31-13.6 16.6-20.7 29-25.4 37.1l-.1.2c-5.1-.7-10.3-1.6-15.4-2.5-27.5-4.9-51.8 6.7-72.4 34.5-16.7 22.5-27.7 51.7-34.2 73.1-1.7-.2-3.3-.3-5-.3-27.1.0-50.4 20.3-54 47.2-5.5 39.8-15.3 87.4-26.2 127.3-13.4 48.9-27.5 83.2-40.8 99.3-27.6 33.4-28.7 66.5-24.7 88.4 6.7 37.3 34.9 73.7 75.5 97.3 55.3 32.2 158.1 92 447 92 268 0 356.3-52.2 414.8-86.8l2.2-1.3c2.3-1.4 4.5-2.7 6.8-4 18.6-10.8 63-41.6 73.8-93.3 4.4-21.8 4.5-55-21.2-90zM919.01 759c-3 1.8-6.1 3.6-9.3 5.5-27.1 16-60.7 35.9-118.5 51.5-67.9 18.3-155.2 27.2-266.9 27.2-273.4.0-367.5-54.8-418.1-84.2-20.2-11.8-43.4-33.1-47.8-57.7-2.6-14.5 1.6-28.5 12.5-41.6 22.3-27 42.5-78.2 60-152.3 10.3-43.7 16.6-82.8 18.8-97.2 28.9 25.2 104.2 42.6 148.1 51 73.8 14.1 161.6 22.5 234.9 22.5 68.4.0 140.7-7.1 203.7-20.1 62.7-12.9 110.4-30.4 134.6-49.3 1.9-.2 3.7-.6 5.5-1.2 7.7 39.5 39.9 194.9 77.8 246.5 10.6 14.4 14.3 29.2 11.2 44.2-4.3 20.1-21.7 40.8-46.5 55.2zm-271.3-509.5c23.2-.1 41.5-.2 57.3 38.6 14.8 36.3 44.2 42 63.7 45.9 18.9 3.7 38.5 7.6 59.3 40.1-15.5 9-49.3 21.8-101.4 32.7v-1c-1.7-55.7-39.4-82-61.3-88.7-7.3-2.3-15.1-1.5-21.9 2.1s-11.8 9.6-14.1 17c-4.7 15.2 3.9 31.3 19 35.9.8.3 19.9 6.8 20.7 35.5.1 3 .7 6 1.8 9-45.5 6.3-91.7 9.6-137.6 9.6h-.8c-68 0-150.1-7.7-219.4-20.6-60.1-11.2-93.1-22.8-108.5-29.4 11.5-43.5 32-79.4 44.4-77.4 38.1 6.7 55.8 8.2 75.1-25.2 4-6.9 9.5-16.4 20.3-29.6 17.9-21.8 31.6-21.8 50.4-14.1 42.5 17.4 70.8-6.5 91.5-24l3.7-3.1c14-11.8 26.1-22.1 43.3-22.1 18.3.0 32.8.0 65.4 49.3.0.1.1.2.1.3.2.5.4 1 .7 1.5 13 17.6 32.6 17.7 48.3 17.7z"/><path d="M197.61 503.7c-15.7-2.2-30.3 8.9-32.4 24.6-3.6 25.7-10.5 55.9-18.6 80.8-9.8 30.3-20.5 50.7-30.8 59.1-6 4.8-9.9 11.6-10.8 19.2-.9 7.6 1.2 15.2 6 21.2s11.6 9.9 19.2 10.8c1.2.1 2.3.2 3.5.2 6.4.0 12.6-2.1 17.7-6.2.2-.2.4-.3.6-.5 21.2-17.1 39.2-50.4 53.4-98.8 11-37.4 16-71.6 16.9-78.1 2-15.6-9-30.2-24.7-32.3zm234.9-238.6c-6.6-4-14.3-5.2-21.8-3.4l-.4.1c-55.8 13.8-74.3 65.3-76.5 93.6-.6 7.7 1.9 15.1 6.9 20.9 5 5.8 12 9.4 19.6 9.9h.1c.7.1 1.4.1 2.1.1 14.9.0 27.5-11.5 28.7-26.6.0-.3 3.2-34.7 32.9-42.1 7.5-1.8 13.8-6.4 17.8-13s5.2-14.3 3.4-21.8c-1.6-7.4-6.2-13.7-12.8-17.7zm144.2 34.3c-1.8.4-18 3.3-28.7-18.6-6.9-14.3-24.2-20.2-38.5-13.3-6.9 3.4-12.1 9.2-14.6 16.5s-2 15.1 1.3 22c22.5 46.2 61.9 51.2 77.8 51.2 5.8.0 11.4-.6 16.2-1.8 7.5-1.8 13.8-6.4 17.8-13s5.2-14.3 3.4-21.8c-1.8-7.5-6.4-13.8-13-17.8s-14.3-5.2-21.7-3.4z"/></svg></div></div><script defer>function fetchData(){fetch("https://api.suyanw.cn/api/tiangou?type=json").then(e=>e.json()).then(e=>{const t=e.text;document.getElementById("apiData").innerText=t,adjustContainerHeight(t)}).catch(e=>console.error("Error:",e))}function adjustContainerHeight(e){const t=180,n=1.2,s=t+e.length*n;document.getElementById("tiangou").style.height=`${s}px`}document.getElementById("refreshButton").addEventListener("click",fetchData),window.matchMedia("(max-width: 768px)").matches||(document.getElementById("refreshButton").addEventListener("click",fetchData),fetchData())</script></div><main id=main-content class=grow><article><figure><img class="w-full rounded-lg single_hero_round nozoom" alt="Tailscale 基础教程：部署私有 DERP 中继服务器" width=1200 height=675 src=/posts/custom-derp-servers/featured_hu8349736d30ee7a454a910741ab8b4fbe_66214_1200x0_resize_q75_box.jpg></figure><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>云原生实验室</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>博客</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/custom-derp-servers/>Tailscale 基础教程：部署私有 DERP 中继服务器</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Tailscale 基础教程：部署私有 DERP 中继服务器</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-03-27 09:06:37 +0800 +0800">2022年3月27日</time><span class="px-2 text-primary-500">&#183;</span><span>5939 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>12 分钟</span><span class="px-2 text-primary-500">&#183;</span><span>
<span id=busuanzi_page_pv></span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span></span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/yangchuansheng/blog/tree/main/content/zh-cn/posts/custom-derp-servers/index.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title=编辑内容><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path fill="currentcolor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg></span></span></a></span><span class="px-2 text-primary-500">&#183;</span>
<script type=text/javascript src=/js/zen-mode.min.ccc8b2a0c4505216444ca25530c7328aa0bef94f43dabaf3e598e1b4271de9eec76c1cb35917471a4f7ccb8d84051b3acef42baa30724ac3a667fcf1fec4432a.js integrity="sha512-zMiyoMRQUhZETKJVMMcyiqC++U9D2rrz5ZjhtCcd6e7HbByzWRdHGk98y42EBRs6zvQrqjBySsOmZ/zx/sRDKg=="></script><span class=mb-[2px]><span id=zen-mode-button class="text-lg hover:text-primary-500" title=启用极简模式 data-title-i18n-disable=启用极简模式 data-title-i18n-enable=关闭极简模式><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="50" height="50"><path fill="currentcolor" d="M12.980469 4C9.1204688 4 5.9804688 7.14 5.9804688 11L6 26H9.9804688V11c0-1.65 1.3400002-3 3.0000002-3H40.019531c1.66.0 3 1.35 3 3V39c0 1.65-1.34 3-3 3H29c0 1.54-.579062 2.94-1.539062 4H40.019531c3.86.0 7-3.14 7-7V11c0-3.86-3.14-7-7-7H12.980469zM7 28c-2.206.0-4 1.794-4 4V42c0 2.206 1.794 4 4 4H23c2.206.0 4-1.794 4-4V32c0-2.206-1.794-4-4-4H7zm0 4H23L23.001953 42H7V32z"/></svg></span></span></span></span></div><div class="flex flex-row flex-wrap items-center"></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/network/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">网络
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/vpn/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">VPN
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/wireguard/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">WireGuard
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/tailscale/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Tailscale
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/headscale/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Headscale</span></span></span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt=米开朗基杨 src=/img/avatar_huc87ff6472ac02dded9d02f85c817eafc_103316_192x192_fill_box_center_3.png><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">作者</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">米开朗基杨</div><div class="text-sm text-neutral-700 dark:text-neutral-400">云原生搬砖师 &
<a href="https://icloudnative.io/go/?target=aHR0cHM6Ly9zZWFsb3MucnVu" target=_blank>Sealos</a> 开发者布道师 &
<a href="https://icloudnative.io/go/?target=aHR0cHM6Ly9naXRodWIuY29tL2xhYnJpbmcvRmFzdEdQVA%3d%3d" target=_blank>FastGPT</a> 熟练工</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=/index.xml target=_blank aria-label=Rss rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 64C0 46.3 14.3 32 32 32c229.8.0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7.0 64zM128 416c0 35.3-28.7 64-64 64S0 451.3.0 416s28.7-64 64-64 64 28.7 64 64zM32 160c159.1.0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7.0-32-14.3-32-32s14.3-32 32-32z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitter.com/CarsonYangk8s target=_blank aria-label=X-Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://images.icloudnative.io/uPic/tmpm1ykjt96.webp target=_blank aria-label=Wechat rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg width="800" height="800" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.8088 7.05902C11.3508 7.06746 10.9637 7.45766 10.9718 7.90277 10.9802 8.36421 11.3599 8.7252 11.8309 8.7196 12.3031 8.71385 12.6613 8.3491 12.6568 7.87785 12.6529 7.41534 12.2749 7.05051 11.8088 7.05902zm-4.45801.85655C7.36789 7.47215 6.98366 7.07275 6.52729 7.05933 6.06002 7.04561 5.67572 7.40269 5.66207 7.8632 5.64827 8.32985 6.0052 8.70373 6.47584 8.71569 6.94241 8.72757 7.33354 8.36996 7.35079 7.91557zm8.54451.75542C14.0388 8.76798 12.4244 9.33078 11.1137 10.6023c-1.3243 1.2847-1.92882 2.8588-1.76358 4.8103C8.62446 15.3226 7.96351 15.2237 7.2988 15.1678 7.06924 15.1484 6.7968 15.1759 6.60235 15.2856 5.95689 15.6498 5.33812 16.061 4.60471 16.5195 4.73928 15.9108 4.82638 15.3778 4.98058 14.8652 5.09398 14.4884 5.04146 14.2788 4.69434 14.0333c-2.22866-1.5734-3.1681-3.9282-2.46505-6.35259.65044-2.24277 2.24776-3.60293 4.41815-4.31196C9.60982 2.4011 12.939 3.38815 14.7404 5.74012 15.391 6.58969 15.7899 7.54323 15.8953 8.67099z" fill="currentcolor"/><path d="M17.6884 12.3843C17.3253 12.3818 17.0167 12.6791 17.0019 13.046 16.9861 13.4383 17.2912 13.7605 17.6794 13.7615 18.055 13.7627 18.3517 13.4787 18.3655 13.105 18.38 12.7117 18.0749 12.387 17.6884 12.3843zm-4.3139 1.3819C13.7489 13.7666 14.057 13.4737 14.0711 13.1041 14.0861 12.7127 13.7713 12.3845 13.3795 12.3828 12.9915 12.381 12.6664 12.714 12.6799 13.0994 12.6927 13.4678 13.003 13.7658 13.3745 13.7662zm6.6919 6.479C19.4785 19.9835 18.9392 19.5907 18.3652 19.5308 17.7932 19.471 17.1919 19.801 16.5936 19.8622 14.771 20.0486 13.138 19.5407 11.7916 18.2956 9.23081 15.927 9.59671 12.2954 12.5594 10.3543c2.6331-1.72503 6.4948-1.14995 8.3513 1.2437C22.5307 13.6866 22.3403 16.4592 20.3626 18.2139 19.7903 18.7217 19.5843 19.1397 19.9515 19.809 20.0193 19.9326 20.027 20.0891 20.0664 20.2452z" fill="currentcolor"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/yangchuansheng target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://t.me/cloudnativer target=_blank aria-label=Telegram rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open class="toc-right mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#stun-是什么>STUN 是什么</a></li><li><a href=#中继是什么>中继是什么</a></li><li><a href=#中继协议简介>中继协议简介</a><ul><li><a href=#turn>TURN</a></li><li><a href=#derp>DERP</a></li></ul></li><li><a href=#自建私有-derp-server>自建私有 DERP server</a><ul><li><a href=#使用域名>使用域名</a></li><li><a href=#使用纯-ip>使用纯 IP</a></li></ul></li><li><a href=#防止-derp-被白嫖>防止 DERP 被白嫖</a></li><li><a href=#总结>总结</a></li><li><a href=#参考资料>参考资料</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#stun-是什么>STUN 是什么</a></li><li><a href=#中继是什么>中继是什么</a></li><li><a href=#中继协议简介>中继协议简介</a><ul><li><a href=#turn>TURN</a></li><li><a href=#derp>DERP</a></li></ul></li><li><a href=#自建私有-derp-server>自建私有 DERP server</a><ul><li><a href=#使用域名>使用域名</a></li><li><a href=#使用纯-ip>使用纯 IP</a></li></ul></li><li><a href=#防止-derp-被白嫖>防止 DERP 被白嫖</a></li><li><a href=#总结>总结</a></li><li><a href=#参考资料>参考资料</a></li></ul></nav></div></details><script>(function(){var t,e=$("#TableOfContents");if(e.length>0){t=$(window);function n(){var s,o=t.scrollTop(),i=$(".anchor"),n="";if(i.each(function(e,t){t=$(t),t.offset().top-$(window).height()/3<=o&&(n=t.attr("id"))}),s=e.find("a.active"),s.length==1&&s.eq(0).attr("href")=="#"+n)return!0;s.each(function(e,t){$(t).removeClass("active")}),e.find('a[href="#'+n+'"]').addClass("active"),e.find('a[href="#'+n+'"]').parentsUntil("#TableOfContents").each(function(e,t){$(t).children("a").parents("ul").show()})}t.on("scroll",n),$(document).ready(function(){n()})}})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><style>.slideContent{@media(max-width:600px){display: none !important;}&>* { user-select: none; } .swiper-slide { a { height: 100%; } img { height: 100%; object-fit: cover; } }}.swiper,swiper-container{margin-left:inherit!important;margin-bottom:-30px;@media(max-width:600px){display: none !important;}}</style><script defer>document.addEventListener("DOMContentLoaded",function(){if(!window.matchMedia("(max-width: 768px)").matches){var e,t=document.createElement("link");t.rel="stylesheet",t.href="https://cdn.jsdelivr.net/npm/swiper@9.0.2/swiper-bundle.min.css",document.head.appendChild(t),e=document.createElement("script"),e.src="https://cdn.jsdelivr.net/npm/swiper@9.0.2/swiper-bundle.min.js",e.onload=function(){var e=new Swiper("#slider",{direction:"horizontal",loop:!0,autoplay:{delay:5e3},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})},document.head.appendChild(e)}})</script><div class="swiper slideContent max-w-prose" id=slider><div class=swiper-wrapper><div class=swiper-slide><a data-umami-event=gptgod href="https://gptgod.online/#/register?invite_code=46rrqz6qzscsey1jci7sdjw95" target=_blank title=gptgod><picture><source media="(min-width: 768px)" srcset=https://images.icloudnative.io/uPic/2023-09-15-12-36-W4I1A8.png><img class=nozoom id=support-img src style=border:none;width:100%;max-width:100%;height:auto;display:inline-block alt=gptgod></picture></a></div><div class=swiper-slide><a data-umami-event=FastGPT href="https://cloud.fastgpt.in/?inviterId=64215e9914d068bf840141d0" target=_blank title=FastGPT><picture><source media="(min-width: 768px)" srcset="https://socialify.git.ci/labring/fastgpt/image?description=1&amp;descriptionEditable=%E5%9F%BA%E4%BA%8E%20LLM%20%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%A5%E8%AF%86%E5%BA%93%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F%EF%BC%8C%E6%8F%90%E4%BE%9B%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E3%80%81%E6%A8%A1%E5%9E%8B%E8%B0%83%E7%94%A8%E7%AD%89%E8%83%BD%E5%8A%9B%E3%80%82&amp;font=Raleway&amp;forks=1&amp;logo=https%3A%2F%2Fcdn.jsdelivr.net%2Fgh%2Flabring%2FFastGPT%40main%2F.github%2Fimgs%2Flogo.svg&amp;name=1&amp;pattern=Brick%20Wall&amp;stargazers=1&amp;theme=Light"><img class=nozoom id=support-img src style=border:none;width:100%;max-width:100%;height:auto;display:inline-block alt=FastGPT></picture></a></div><div class=swiper-slide><a data-umami-event=Laf href=https://github.com/labring/laf target=_blank title=Laf><picture><source media="(min-width: 768px)" srcset="https://socialify.git.ci/labring/laf/image?description=1&amp;descriptionEditable=Laf%20%E6%98%AF%E4%B8%80%E4%B8%AA%20Serverless%20%E6%A1%86%E6%9E%B6%EF%BC%8C%E6%8F%90%E4%BE%9B%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8%E7%9A%84%E4%BA%91%E5%87%BD%E6%95%B0%EF%BC%8C%E4%BA%91%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E7%AD%89%E8%83%BD%E5%8A%9B%E3%80%82%E8%AE%A9%E5%BC%80%E5%8F%91%E8%80%85%E4%B8%93%E6%B3%A8%E4%BA%8E%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%EF%BC%8C%E6%97%A0%E9%9C%80%E6%8A%98%E8%85%BE%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E5%BF%AB%E9%80%9F%E9%87%8A%E6%94%BE%E5%88%9B%E6%84%8F%E3%80%82&amp;font=Raleway&amp;forks=1&amp;logo=https%3A%2F%2Fcdn.jsdelivr.net%2Fgh%2Fyangchuansheng%2Fimghosting-test%40main%2FuPic%2F2023-11-13-11-33-rI41Bu.svg&amp;name=1&amp;pattern=Brick%20Wall&amp;stargazers=1&amp;theme=Light"><img class=nozoom id=support-img src style=border:none;width:100%;max-width:100%;height:auto;display:inline-block alt=Laf></picture></a></div><div class=swiper-slide><a data-umami-event="Contact me" href=https://images.icloudnative.io/uPic/20200430221955.png target=_blank title="Contact me"><picture><source media="(min-width: 768px)" srcset=https://images.icloudnative.io/uPic/2023-02-05-16-18-ofcgZS.png><img class=nozoom id=support-img src style=border:none;width:100%;max-width:100%;height:auto;display:inline-block alt="Contact me"></picture></a></div></div><div class=swiper-button-prev></div><div class=swiper-button-next></div></div><details style=margin-left:0 class="mt-2 mb-5 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 max-w-prose"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">Tailscale 系列教程 - 本文属于系列文章之一</summary><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=https://icloudnative.io/posts/tailscale-acls/>Part : Tailscale/Headscale ACL 使用教程</a></div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">Part : 本文</div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=https://icloudnative.io/posts/how-to-set-up-or-migrate-headscale/>Part : Tailscale 基础教程：Headscale 的部署方法和使用教程</a></div></details><div class="article-content max-w-prose mb-20"><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/2022-03-27-11-54-F9DnXG.png alt="图片描述: 2022-03-27-11-54-F9DnXG.png"></figure></p><p><a href="https://icloudnative.io/go/?target=L3Bvc3RzL2hvdy10by1zZXQtdXAtb3ItbWlncmF0ZS1oZWFkc2NhbGUvIyVFNiU4MCVCQiVFNyVCQiU5Mw%3d%3d" target=_blank>上篇文章</a>介绍了如何使用 <code>Headscale</code> 替代 Tailscale 官方的控制服务器，并接入各个平台的客户端。本文将会介绍如何让 Tailscale 使用自定义的 DERP Servers。可能很多人都不知道 <code>DERP</code> 是个啥玩意儿，没关系，我先从<strong>中继服务器</strong>开始讲起。</p><h2 class="relative group">STUN 是什么<div id=stun-%E6%98%AF%E4%BB%80%E4%B9%88 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#stun-%E6%98%AF%E4%BB%80%E4%B9%88 aria-label=锚点>#</a></span></h2><p>Tailscale 的终极目标是让两台<strong>处于网络上的任何位置</strong>的机器建立<strong>点对点连接</strong>（直连），但现实世界是复杂的，大部份情况下机器都位于 NAT 和防火墙后面，这时候就需要通过打洞来实现直连，也就是 NAT 穿透。</p><p>NAT 按照 <strong>NAT 映射行为</strong>和<strong>有状态防火墙行为</strong>可以分为多种类型，但对于 NAT 穿透来说根本不需要关心这么多类型，只需要看 <strong>NAT 或者有状态防火墙是否会严格检查目标 Endpoint</strong>，根据这个因素，可以将 NAT 分为 <strong>Easy NAT</strong> 和 <strong>Hard NAT</strong>。</p><ul><li><p><strong>Easy NAT</strong> 及其变种称为 “Endpoint-Independent Mapping” (<strong>EIM，终点无关的映射</strong>)<br>这里的 Endpoint 指的是目标 Endpoint，也就是说，有状态防火墙只要看到有客户端自己发起的出向包，就会允许相应的入向包进入，<strong>不管这个入向包是谁发进来的都可以</strong>。</p></li><li><p><strong>hard NAT</strong> 以及变种称为 “Endpoint-Dependent Mapping”（<strong>EDM，终点相关的映射</strong>）<br>这种 NAT 会针对每个目标 Endpoint 来生成一条相应的映射关系。 在这样的设备上，如果客户端向某个目标 Endpoint 发起了出向包，假设客户端的公网 IP 是 2.2.2.2，那么有状态防火墙就会打开一个端口，假设是 4242。那么只有来自该目标 Endpoint 的入向包才允许通过 <code>2.2.2.2:4242</code>，其他客户端一律不允许。这种 NAT 更加严格，所以叫 Hard NAT。</p></li></ul><p>对于 Easy NAT，我们只需要提供一个第三方的服务，它能够告诉客户端“它看到的客户端的公网 ip:port 是什么”，然后将这个信息以某种方式告诉通信对端（peer），后者就知道该和哪个地址建连了！这种服务就叫 <strong>STUN</strong> (Session Traversal Utilities for NAT，NAT会话穿越应用程序)。它的工作流程如下图所示：</p><ul><li>笔记本向 STUN 服务器发送一个请求：“从你的角度看，我的地址什么？”</li><li>STUN 服务器返回一个响应：“我看到你的 UDP 包是从这个地址来的：<code>ip:port</code>”。</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/2022-03-26-17-27-yqHlMG.jpg alt="图片描述: 2022-03-26-17-27-yqHlMG.jpg"></figure></p><h2 class="relative group">中继是什么<div id=%E4%B8%AD%E7%BB%A7%E6%98%AF%E4%BB%80%E4%B9%88 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E4%B8%AD%E7%BB%A7%E6%98%AF%E4%BB%80%E4%B9%88 aria-label=锚点>#</a></span></h2><p>对于 <strong>Hard NAT</strong> 来说，STUN 就不好使了，即使 STUN 拿到了客户端的公网 <code>ip:port</code> 告诉通信对端也于事无补，因为防火墙是和 STUN 通信才打开的缺口，这个缺口只允许 STUN 的入向包进入，其他通信对端知道了这个缺口也进不来。通常企业级 NAT 都属于 Hard NAT。</p><p>这种情况下打洞是不可能了，但也不能就此放弃，可以选择一种折衷的方式：创建一个中继服务器（relay server），客户端与中继服务器进行通信，中继服务器再将包中继（relay）给通信对端。</p><p>至于中继的性能，那要看具体情况了：</p><ul><li>如果能直连，那显然没必要用中继方式；</li><li>但如果无法直连，而中继路径又非常接近双方直连的真实路径，并且带宽足够大，那中继方式并不会明显降低通信质量。延迟肯定会增加一点，带宽会占用一些，但<strong>相比完全连接不上，还是可以接受的</strong>。</li></ul><p>事实上对于大部分网络而言，Tailscale 都可以通过各种黑科技打洞成功，只有极少数情况下才会选择中继，中继只是一种 fallback 机制。</p><h2 class="relative group">中继协议简介<div id=%E4%B8%AD%E7%BB%A7%E5%8D%8F%E8%AE%AE%E7%AE%80%E4%BB%8B class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E4%B8%AD%E7%BB%A7%E5%8D%8F%E8%AE%AE%E7%AE%80%E4%BB%8B aria-label=锚点>#</a></span></h2><p>中继协议有多种实现方式。</p><h3 class="relative group">TURN<div id=turn class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#turn aria-label=锚点>#</a></span></h3><p>TURN 即 Traversal Using Relays around NAT，这是一种经典的中继实现方式，核心理念是：</p><ul><li><strong>用户</strong>（人）先去公网上的 TURN 服务器认证，成功后后者会告诉你：“我已经为你分配了 ip:port，接下来将为你中继流量”，</li><li>然后将这个 ip:port 地址告诉对方，让它去连接这个地址，接下去就是非常简单的客户端/服务器通信模型了。</li></ul><p>与 STUN 不同，这种协议没有真正的交互性，不是很好用，因此 Tailscale 并没有采用 TURN 作为中继协议。</p><h3 class="relative group">DERP<div id=derp class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#derp aria-label=锚点>#</a></span></h3><p>DERP 即 Detoured Encrypted Routing Protocol，这是 Tailscale 自研的一个协议：</p><ul><li>它是一个<strong>通用目的包中继协议，运行在 HTTP 之上</strong>，而大部分网络都是允许 HTTP 通信的。</li><li>它根据目的公钥（destination’s public key）来中继加密的流量（encrypted payloads）。</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/2022-03-26-19-02-zLDv51.svg alt="Tailscale 会自动选择离目标节点最近的 DERP server 来中继流量"></figure></p><p>Tailscale 使用的算法很有趣，<strong>所有客户端之间的连接都是先选择 DERP 模式（中继模式），这意味着连接立即就能建立（优先级最低但 100% 能成功的模式），用户不用任何等待</strong>。然后开始并行地进行路径发现，通常几秒钟之后，我们就能发现一条更优路径，然后将现有连接透明升级（upgrade）过去，变成点对点连接（直连）。</p><p>因此，DERP 既是 Tailscale 在 NAT 穿透失败时的保底通信方式（此时的角色与 TURN 类似），也是在其他一些场景下帮助我们完成 NAT 穿透的旁路信道。 换句话说，它既是我们的保底方式，也是有更好的穿透链路时，帮助我们进行连接升级（upgrade to a peer-to-peer connection）的基础设施。</p><h2 class="relative group">自建私有 DERP server<div id=%E8%87%AA%E5%BB%BA%E7%A7%81%E6%9C%89-derp-server class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E8%87%AA%E5%BB%BA%E7%A7%81%E6%9C%89-derp-server aria-label=锚点>#</a></span></h2><p>Tailscale 的私钥只会保存在当前节点，因此 DERP server 无法解密流量，它只能和互联网上的其他路由器一样，呆呆地将加密的流量从一个节点转发到另一个节点，只不过 DERP 使用了一个稍微高级一点的协议来防止滥用。</p><p>Tailscale 开源了 DERP 服务器的代码，如果你感兴趣，可以阅读
<a href="https://icloudnative.io/go/?target=aHR0cHM6Ly9naXRodWIuY29tL3RhaWxzY2FsZS90YWlsc2NhbGUvdHJlZS9tYWluL2RlcnA%3d" target=_blank>DERP 的源代码</a>。</p><hr><p>Tailscale 官方内置了很多 DERP 服务器，分步在全球各地，<strong>惟独不包含中国大陆</strong>，原因你懂得。这就导致了一旦流量通过 DERP 服务器进行中继，延时就会非常高。而且官方提供的 DERP 服务器是万人骑，存在安全隐患。</p><p>为了实现低延迟、高安全性，我们可以参考
<a href="https://icloudnative.io/go/?target=aHR0cHM6Ly90YWlsc2NhbGUuY29tL2tiLzExMTgvY3VzdG9tLWRlcnAtc2VydmVycy8%3d" target=_blank>Tailscale 官方文档</a>自建私有的 DERP 服务器。有两种部署模式，一种是基于域名，另外一种不需要域名，可以直接使用 IP，不过需要一点黑科技。我们先来看最简单的使用域名的方案。</p><h3 class="relative group">使用域名<div id=%E4%BD%BF%E7%94%A8%E5%9F%9F%E5%90%8D class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E4%BD%BF%E7%94%A8%E5%9F%9F%E5%90%8D aria-label=锚点>#</a></span></h3><p>这种方案需要满足以下几个条件：</p><ul><li>要有自己的域名，并且申请了 SSL 证书</li><li>需要准备一台或多台云主机</li><li>如果服务器在国内，域名需要备案</li><li>如果服务器在国外，则不需要备案</li></ul><p>如果以上条件都俱备，就可以按照下面的步骤开始部署了。</p><p>推荐直接使用 Docker 来部署，我已经构建好了 Docker 镜像，直接部署就可以了：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>🐳  → docker run --restart always <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --name derper -p 12345:12345 -p 3478:3478/udp <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v /root/.acme.sh/xxxx/:/app/certs <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>DERP_CERT_MODE</span><span class=o>=</span>manual <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>DERP_ADDR</span><span class=o>=</span>:12345 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>DERP_DOMAIN</span><span class=o>=</span>xxxx <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -d ghcr.io/yangchuansheng/derper:latest
</span></span></code></pre></div><p>有几点需要注意：</p><ul><li>能用 443 端口尽量用 443 端口，实在不行再用别的端口；</li><li>默认情况下也会开启 STUN 服务，UDP 端口是 <code>3478</code>；</li><li>防火墙需要放行端口 12345 和 3478；</li><li>准备好 SSL 证书；</li><li>域名部分我打了码，请换成你自己的域名。</li></ul><p>关于证书部分需要重点说明：<strong>假设你的域名是 <code>xxx.com</code>，那么证书的名称必须是 <code>xxx.com.crt</code>，一个字符都不能错！同理，私钥名称必须是 <code>xxx.com.key</code>，一个字符都不能错！</strong></p><p>查看容器日志：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>🐳  → docker logs -f derper
</span></span><span class=line><span class=cl>2022/03/26 11:36:28 no config path specified<span class=p>;</span> using /var/lib/derper/derper.key
</span></span><span class=line><span class=cl>2022/03/26 11:36:28 derper: serving on :12345 with TLS
</span></span><span class=line><span class=cl>2022/03/26 11:36:28 running STUN server on <span class=o>[</span>::<span class=o>]</span>:3478
</span></span></code></pre></div><p>目前 derper 运行一段时间就会崩溃，暂时还没有更好的解决方案，只能通过定时重启来解决，比如通过 crontab 来设置每两小时重启一次容器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=m>0</span> */2 * * * docker restart derper <span class=p>&amp;</span>&gt; /dev/null
</span></span></code></pre></div><p>具体可参考这个 issue：
<a href="https://icloudnative.io/go/?target=aHR0cHM6Ly9naXRodWIuY29tL3RhaWxzY2FsZS90YWlsc2NhbGUvaXNzdWVzLzQwODI%3d" target=_blank>Derper TLS handshake error: remote error: tls: internal error</a></p><hr><p>部署好 derper 之后，就可以修改 Headscale 的配置来使用自定义的 DERP 服务器了。Headscale 可以通过两种形式的配置来使用自定义 DERP：</p><ul><li>一种是在线 URL，格式是 <code>JSON</code>，与 Tailscale 官方控制服务器使用的格式和语法相同。</li><li>另一种是本地文件，格式是 <code>YAML</code>。</li></ul><p>我们可以直接使用本地的 YAML 配置文件，内容如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># /etc/headscale/derp.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>regions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>900</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>regionid</span><span class=p>:</span><span class=w> </span><span class=m>900</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>regioncode</span><span class=p>:</span><span class=w> </span><span class=l>thk </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>regionname</span><span class=p>:</span><span class=w> </span><span class=l>Tencent Hongkong </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nodes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>900a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>regionid</span><span class=p>:</span><span class=w> </span><span class=m>900</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>xxxx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ipv4</span><span class=p>:</span><span class=w> </span><span class=l>xxxx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>stunport</span><span class=p>:</span><span class=w> </span><span class=m>3478</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>stunonly</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>derpport</span><span class=p>:</span><span class=w> </span><span class=m>12345</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>900b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>regionid</span><span class=p>:</span><span class=w> </span><span class=m>900</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>xxxx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ipv4</span><span class=p>:</span><span class=w> </span><span class=l>xxxx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>stunport</span><span class=p>:</span><span class=w> </span><span class=m>3478</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>stunonly</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>derpport</span><span class=p>:</span><span class=w> </span><span class=m>12345</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>901</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>regionid</span><span class=p>:</span><span class=w> </span><span class=m>901</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>regioncode</span><span class=p>:</span><span class=w> </span><span class=l>hs </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>regionname</span><span class=p>:</span><span class=w> </span><span class=l>Huawei Shanghai </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nodes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>901a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>regionid</span><span class=p>:</span><span class=w> </span><span class=m>901</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>xxxx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ipv4</span><span class=p>:</span><span class=w> </span><span class=l>xxxx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>stunport</span><span class=p>:</span><span class=w> </span><span class=m>3478</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>stunonly</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>derpport</span><span class=p>:</span><span class=w> </span><span class=m>12345</span><span class=w>
</span></span></span></code></pre></div><p>配置说明：</p><ul><li><code>regions</code> 是 YAML 中的<strong>对象</strong>，下面的每一个对象表示一个<strong>可用区</strong>，每个<strong>可用区</strong>里面可设置多个 DERP 节点，即 <code>nodes</code>。</li><li>每个可用区的 <code>regionid</code> 不能重复。</li><li>每个 <code>node</code> 的 <code>name</code> 不能重复。</li><li><code>regionname</code> 一般用来描述可用区，<code>regioncode</code> 一般设置成可用区的缩写。</li><li><code>ipv4</code> 字段不是必须的，如果你的域名可以通过公网解析到你的 DERP 服务器地址，这里可以不填。如果你使用了一个二级域名，而这个域名你并没有在公共 DNS server 中添加相关的解析记录，那么这里就需要指定 IP（前提是你的证书包含了这个二级域名，这个很好支持，搞个泛域名证书就行了）。</li><li><code>stunonly: false</code> 表示除了使用 STUN 服务，还可以使用 DERP 服务。</li><li>上面的配置中域名和 IP 部分我都打码了，你需要根据你的实际情况填写。</li></ul><p>接下来还需要修改 Headscale 的配置文件，引用上面的自定义 DERP 配置文件。需要修改的配置项如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># /etc/headscale/config.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>derp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># List of externally available DERP maps encoded in JSON</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>urls</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  - https://controlplane.tailscale.com/derpmap/default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Locally available DERP map files encoded in YAML</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># This option is mostly interesting for people hosting</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># their own DERP servers:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># https://tailscale.com/kb/1118/custom-derp-servers/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># paths:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#   - /etc/headscale/derp-example.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>/etc/headscale/derp.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># If enabled, a worker will be set up to periodically</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># refresh the given sources and update the derpmap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># will be set up.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>auto_update_enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># How often should we check for DERP updates?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>update_frequency</span><span class=p>:</span><span class=w> </span><span class=l>24h</span><span class=w>
</span></span></span></code></pre></div><p>可以把 Tailscale 官方的 DERP 服务器禁用，来测试自建的 DERP 服务器是否能正常工作。</p><p>修改完配置后，重启 headscale 服务：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ systemctl restart headscale
</span></span></code></pre></div><p>在 Tailscale 客户端上使用以下命令查看目前可以使用的 DERP 服务器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ tailscale netcheck
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Report:
</span></span><span class=line><span class=cl>        * UDP: <span class=nb>true</span>
</span></span><span class=line><span class=cl>        * IPv4: yes, xxxxx:57068
</span></span><span class=line><span class=cl>        * IPv6: no
</span></span><span class=line><span class=cl>        * MappingVariesByDestIP: <span class=nb>false</span>
</span></span><span class=line><span class=cl>        * HairPinning: <span class=nb>false</span>
</span></span><span class=line><span class=cl>        * PortMapping: 
</span></span><span class=line><span class=cl>        * Nearest DERP: Tencent Hongkong
</span></span><span class=line><span class=cl>        * DERP latency:
</span></span><span class=line><span class=cl>                - thk: 39.7ms <span class=o>(</span>Tencent Hongkong<span class=o>)</span>
</span></span></code></pre></div><p><code>tailscale netcheck</code> 实际上只检测 <code>3478/udp</code> 的端口， 就算 netcheck 显示能连，也不一定代表 12345 端口可以转发流量。最简单的办法是直接打开 DERP 服务器的 URL：https://xxxx:12345，如果看到如下页面，且地址栏的 SSL 证书标签显示正常可用，那才是真没问题了。</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://images.icloudnative.io/uPic/2022-03-27-11-21-dZ5dtZ.png alt="图片描述: 2022-03-27-11-21-dZ5dtZ.png"></figure></p><p>查看与通信对端的连接方式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ tailscale status
</span></span><span class=line><span class=cl>10.1.0.5        coredns              default      linux   -
</span></span><span class=line><span class=cl>                carsondemacbook-pro  default      macOS   active<span class=p>;</span> direct xxxx:2756<span class=p>;</span> offline, tx <span class=m>50424</span> rx <span class=m>34056</span>
</span></span><span class=line><span class=cl>                oneplus-8t           default      android active<span class=p>;</span> relay <span class=s2>&#34;thk&#34;</span><span class=p>;</span> offline, tx <span class=m>1608</span> rx <span class=m>1552</span>
</span></span><span class=line><span class=cl>                openwrt              default      linux   active<span class=p>;</span> direct xxxx:2834<span class=p>;</span> offline, tx <span class=m>1403688</span> rx <span class=m>1217620</span>
</span></span></code></pre></div><p>这个客户端是一台云主机，有 3 个通信对端，分别是 macOS、OpenWRT 与 Android 手机，macOS 和 OpenWRT 都处于电信家庭内网中，Android 手机使用的是电信流量。可以看到只有 Android 手机是通过自定义的 DERP 服务器来中继流量的，打洞成功率相当高。使用 ping 来测试连通性：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ping 10.1.0.8
</span></span><span class=line><span class=cl>PING 10.1.0.8 <span class=o>(</span>10.1.0.8<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.1.0.8: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span><span class=m>150</span> ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.1.0.8: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>2</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span><span class=m>131</span> ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.1.0.8: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>3</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span><span class=m>161</span> ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.1.0.8: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>4</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span><span class=m>137</span> ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.1.0.8: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>5</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span><span class=m>156</span> ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.1.0.8: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>6</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span><span class=m>169</span> ms
</span></span><span class=line><span class=cl>^C
</span></span><span class=line><span class=cl>--- 10.1.0.8 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>6</span> packets transmitted, <span class=m>6</span> received, 0% packet loss, <span class=nb>time</span> 5005ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 131.728/151.154/169.627/13.193 ms
</span></span></code></pre></div><p>也可以使用 Tailscale 命令行工具来测试：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ tailscale ping 10.1.0.8
</span></span><span class=line><span class=cl>pong from oneplus-8t <span class=o>(</span>10.1.0.8<span class=o>)</span> via DERP<span class=o>(</span>thk<span class=o>)</span> in 104ms
</span></span><span class=line><span class=cl>pong from oneplus-8t <span class=o>(</span>10.1.0.8<span class=o>)</span> via DERP<span class=o>(</span>thk<span class=o>)</span> in 111ms
</span></span><span class=line><span class=cl>pong from oneplus-8t <span class=o>(</span>10.1.0.8<span class=o>)</span> via DERP<span class=o>(</span>thk<span class=o>)</span> in 105ms
</span></span></code></pre></div><p>这个更加友好一点，会直接告诉你是通过 DERP 中继服务器来和对方通信的。</p><p>如果当前 Tailscale 客户端所在主机开启了 IPv6，那么与手机便可以直接通过 IPv6 点对点连接：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ /Applications/Tailscale.app/Contents/MacOS/Tailscale status
</span></span><span class=line><span class=cl>                coredns              default      linux   active<span class=p>;</span> direct xxxx:45986<span class=p>;</span> offline, tx <span class=m>124352</span> rx <span class=m>185736</span>
</span></span><span class=line><span class=cl>                oneplus-8t           default      android active<span class=p>;</span> direct <span class=o>[</span>240e:472:da0:24a2:a07f:2a67:2a1e:4475<span class=o>]</span>:37237<span class=p>;</span> offline, tx <span class=m>125216</span> rx <span class=m>20052</span>
</span></span><span class=line><span class=cl>                openwrt              default      linux   active<span class=p>;</span> direct <span class=o>[</span>240e:390:caf:1870:c02c:e8ff:feb9:b0b<span class=o>]</span>:41641<span class=p>;</span> offline, tx <span class=m>181992</span> rx <span class=m>3910120</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ /Applications/Tailscale.app/Contents/MacOS/Tailscale ping 10.1.0.8
</span></span><span class=line><span class=cl>pong from oneplus-8t <span class=o>(</span>10.1.0.8<span class=o>)</span> via <span class=o>[</span>240e:472:da0:24a2:a07f:2a67:2a1e:4475<span class=o>]</span>:37237 in 62ms
</span></span></code></pre></div><p>所以如果你开启了 IPv6，可以大大增加<strong>点对点连接</strong>的成功率。</p><h3 class="relative group">使用纯 IP<div id=%E4%BD%BF%E7%94%A8%E7%BA%AF-ip class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E4%BD%BF%E7%94%A8%E7%BA%AF-ip aria-label=锚点>#</a></span></h3><p>我知道，大部分人是没有自己的域名的。再退一步，就算有自己的域名，如果没有备案，也是没办法部署在国内服务器上使用的。</p><p>这个时候我们就只能从 derper 源码上动手脚了，找到 tailscale 仓库中的 <code>cmd/derper/cert.go</code> 文件，将与域名验证相关的内容删除或注释：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>manualCertManager</span><span class=p>)</span> <span class=nf>getCertificate</span><span class=p>(</span><span class=nx>hi</span> <span class=o>*</span><span class=nx>tls</span><span class=p>.</span><span class=nx>ClientHelloInfo</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>tls</span><span class=p>.</span><span class=nx>Certificate</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>//if hi.ServerName != m.hostname {
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>//	return nil, fmt.Errorf(&#34;cert mismatch with hostname: %q&#34;, hi.ServerName)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>//}
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span> <span class=nx>m</span><span class=p>.</span><span class=nx>cert</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>还需要创建自签名证书，可以通过脚本来创建：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># build_cert.sh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#!/bin/bash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>CERT_HOST</span><span class=o>=</span><span class=nv>$1</span>
</span></span><span class=line><span class=cl><span class=nv>CERT_DIR</span><span class=o>=</span><span class=nv>$2</span>
</span></span><span class=line><span class=cl><span class=nv>CONF_FILE</span><span class=o>=</span><span class=nv>$3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;[req]
</span></span></span><span class=line><span class=cl><span class=s2>default_bits  = 2048
</span></span></span><span class=line><span class=cl><span class=s2>distinguished_name = req_distinguished_name
</span></span></span><span class=line><span class=cl><span class=s2>req_extensions = req_ext
</span></span></span><span class=line><span class=cl><span class=s2>x509_extensions = v3_req
</span></span></span><span class=line><span class=cl><span class=s2>prompt = no
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>[req_distinguished_name]
</span></span></span><span class=line><span class=cl><span class=s2>countryName = XX
</span></span></span><span class=line><span class=cl><span class=s2>stateOrProvinceName = N/A
</span></span></span><span class=line><span class=cl><span class=s2>localityName = N/A
</span></span></span><span class=line><span class=cl><span class=s2>organizationName = Self-signed certificate
</span></span></span><span class=line><span class=cl><span class=s2>commonName = </span><span class=nv>$CERT_HOST</span><span class=s2>: Self-signed certificate
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>[req_ext]
</span></span></span><span class=line><span class=cl><span class=s2>subjectAltName = @alt_names
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>[v3_req]
</span></span></span><span class=line><span class=cl><span class=s2>subjectAltName = @alt_names
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>[alt_names]
</span></span></span><span class=line><span class=cl><span class=s2>IP.1 = </span><span class=nv>$CERT_HOST</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>&#34;</span> &gt; <span class=s2>&#34;</span><span class=nv>$CONF_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mkdir -p <span class=s2>&#34;</span><span class=nv>$CERT_DIR</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>openssl req -x509 -nodes -days <span class=m>730</span> -newkey rsa:2048 -keyout <span class=s2>&#34;</span><span class=nv>$CERT_DIR</span><span class=s2>/</span><span class=nv>$CERT_HOST</span><span class=s2>.key&#34;</span> -out <span class=s2>&#34;</span><span class=nv>$CERT_DIR</span><span class=s2>/</span><span class=nv>$CERT_HOST</span><span class=s2>.crt&#34;</span> -config <span class=s2>&#34;</span><span class=nv>$CONF_FILE</span><span class=s2>&#34;</span>
</span></span></code></pre></div><p>重新编写 Dockerfile，将 derper 的域名设置为 <code>127.0.0.1</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> golang:latest AS builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># ========= CONFIG =========</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># - download links</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>MODIFIED_DERPER_GIT</span><span class=o>=</span>https://github.com/yangchuansheng/ip_derper.git<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>BRANCH</span><span class=o>=</span>ip_derper
</span></span><span class=line><span class=cl><span class=c># ==========================</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># build modified derper</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> git clone -b <span class=nv>$BRANCH</span> <span class=nv>$MODIFIED_DERPER_GIT</span> tailscale --depth <span class=m>1</span> <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nb>cd</span> /app/tailscale/cmd/derper <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    /usr/local/go/bin/go build -ldflags <span class=s2>&#34;-s -w&#34;</span> -o /app/derper <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nb>cd</span> /app <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    rm -rf /app/tailscale<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> ubuntu:20.04</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># ========= CONFIG =========</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># - derper args</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>DERP_HOST</span><span class=o>=</span><span class=m>127</span>.0.0.1<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>DERP_CERTS</span><span class=o>=</span>/app/certs/<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> DERP_STUN true<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> DERP_VERIFY_CLIENTS false<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># ==========================</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># apt</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    apt-get install -y openssl curl<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> build_cert.sh /app/<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /app/derper /app/derper<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># build self-signed certs &amp;&amp; start derper</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> bash /app/build_cert.sh <span class=nv>$DERP_HOST</span> <span class=nv>$DERP_CERTS</span> /app/san.conf <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    /app/derper --hostname<span class=o>=</span><span class=nv>$DERP_HOST</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --certmode<span class=o>=</span>manual <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --certdir<span class=o>=</span><span class=nv>$DERP_CERTS</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --stun<span class=o>=</span><span class=nv>$DERP_STUN</span>  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --verify-clients<span class=o>=</span><span class=nv>$DERP_VERIFY_CLIENTS</span><span class=err>
</span></span></span></code></pre></div><p>构建好镜像后，就可以在你想部署 derper 的主机上直接通过该镜像启动 derper 容器了，命令如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>🐳  → docker run --restart always --net host --name derper -d ghcr.io/yangchuansheng/ip_derper
</span></span></code></pre></div><p>和使用域名的方案一样，防火墙需要放行相应端口（12345 与 3478）。</p><p>查看容器日志：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>🐳  → docker logs -f derper
</span></span><span class=line><span class=cl>Generating a RSA private key
</span></span><span class=line><span class=cl>.......................................+++++
</span></span><span class=line><span class=cl>..............+++++
</span></span><span class=line><span class=cl>writing new private key to <span class=s1>&#39;/app/certs//127.0.0.1.key&#39;</span>
</span></span><span class=line><span class=cl>-----
</span></span><span class=line><span class=cl>2022/03/26 14:30:31 no config path specified<span class=p>;</span> using /var/lib/derper/derper.key
</span></span><span class=line><span class=cl>2022/03/26 14:30:31 derper: serving on :443 with TLS
</span></span><span class=line><span class=cl>2022/03/26 14:30:31 running STUN server on <span class=o>[</span>::<span class=o>]</span>:3478
</span></span></code></pre></div><p>如果你想自己构建 derper 镜像，可以参考
<a href="https://icloudnative.io/go/?target=aHR0cHM6Ly9naXRodWIuY29tL3lhbmdjaHVhbnNoZW5nL2lwX2RlcnBlcg%3d%3d" target=_blank>我的 GitHub 仓库</a>。</p><hr><p>下面就是骚操作了，我们在 Headscale 的配置中需要<strong>将 DERP 的域名设置为 IP</strong>！不理解的可以再消化一下，然后继续往下看哈哈~~</p><p>除了 derper 之外，Tailscale 客户端还需要<strong>跳过域名验证</strong>，这个需要在 DERP 的配置中设置。而 Headscale 的本地 YAML 文件目前还不支持这个配置项，所以没办法，咱只能使用在线 URL 了。JSON 配置内容如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Regions&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;901&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;RegionID&#34;</span><span class=p>:</span> <span class=mi>901</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;RegionCode&#34;</span><span class=p>:</span> <span class=s2>&#34;ali-sh&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;RegionName&#34;</span><span class=p>:</span> <span class=s2>&#34;Aliyun Shanghai&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Nodes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;Name&#34;</span><span class=p>:</span> <span class=s2>&#34;901a&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;RegionID&#34;</span><span class=p>:</span> <span class=mi>901</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;DERPPort&#34;</span><span class=p>:</span> <span class=mi>443</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;HostName&#34;</span><span class=p>:</span> <span class=s2>&#34;xxxx&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;IPv4&#34;</span><span class=p>:</span> <span class=s2>&#34;xxxx&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;InsecureForTests&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>配置解析：</p><ul><li><code>HostName</code> 直接填 derper 的公网 IP，即和 <code>IPv4</code> 的值相同。</li><li><code>InsecureForTests</code> 一定要设置为 true，以跳过域名验证。</li></ul><p>你需要把这个 JSON 文件变成 Headscale 服务器可以访问的 URL，比如在 Headscale 主机上搭个 Nginx，或者上传到对象存储（比如阿里云 OSS）。</p><p>接下来还需要修改 Headscale 的配置文件，引用上面的自定义 DERP 的 URL。需要修改的配置项如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># /etc/headscale/config.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>derp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># List of externally available DERP maps encoded in JSON</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>urls</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  - https://controlplane.tailscale.com/derpmap/default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>https://xxxxx/derp.json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Locally available DERP map files encoded in YAML</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># This option is mostly interesting for people hosting</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># their own DERP servers:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># https://tailscale.com/kb/1118/custom-derp-servers/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># paths:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#   - /etc/headscale/derp-example.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>/etc/headscale/derp.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># If enabled, a worker will be set up to periodically</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># refresh the given sources and update the derpmap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># will be set up.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>auto_update_enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># How often should we check for DERP updates?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>update_frequency</span><span class=p>:</span><span class=w> </span><span class=l>24h</span><span class=w>
</span></span></span></code></pre></div><p>修改完配置后，重启 headscale 服务：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ systemctl restart headscale
</span></span></code></pre></div><p>在 Tailscale 客户端上使用以下命令查看目前可以使用的 DERP 服务器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ tailscale netcheck
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Report:
</span></span><span class=line><span class=cl>	* UDP: <span class=nb>true</span>
</span></span><span class=line><span class=cl>	* IPv4: yes, 192.168.100.1:49656
</span></span><span class=line><span class=cl>	* IPv6: no
</span></span><span class=line><span class=cl>	* MappingVariesByDestIP: <span class=nb>true</span>
</span></span><span class=line><span class=cl>	* HairPinning: <span class=nb>false</span>
</span></span><span class=line><span class=cl>	* PortMapping: UPnP
</span></span><span class=line><span class=cl>	* Nearest DERP: Home Hangzhou
</span></span><span class=line><span class=cl>	* DERP latency:
</span></span><span class=line><span class=cl>		- home: 9.7ms   <span class=o>(</span>Home Hangzhou<span class=o>)</span>
</span></span><span class=line><span class=cl>		-  hs: 25.2ms  <span class=o>(</span>Huawei Shanghai<span class=o>)</span>
</span></span><span class=line><span class=cl>		- thk: 43.5ms  <span class=o>(</span>Tencent Hongkong<span class=o>)</span>
</span></span></code></pre></div><p>再次查看与通信对端的连接方式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ tailscale status
</span></span><span class=line><span class=cl>                coredns              default      linux   active<span class=p>;</span> direct xxxx:45986<span class=p>;</span> offline, tx <span class=m>131012</span> rx <span class=m>196020</span>
</span></span><span class=line><span class=cl>                oneplus-8t           default      android active<span class=p>;</span> relay <span class=s2>&#34;home&#34;</span><span class=p>;</span> offline, tx <span class=m>211900</span> rx <span class=m>22780</span>
</span></span><span class=line><span class=cl>                openwrt              default      linux   active<span class=p>;</span> direct 192.168.100.254:41641<span class=p>;</span> offline, tx <span class=m>189868</span> rx <span class=m>4074772</span>
</span></span></code></pre></div><p>可以看到这一次 Tailscale 自动选择了一个线路最优的<strong>国内的</strong> DERP 服务器作为中继，可以测试一下延迟：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ tailscale ping 10.1.0.8
</span></span><span class=line><span class=cl>pong from oneplus-8t <span class=o>(</span>10.1.0.8<span class=o>)</span> via DERP<span class=o>(</span>home<span class=o>)</span> in 30ms
</span></span><span class=line><span class=cl>pong from oneplus-8t <span class=o>(</span>10.1.0.8<span class=o>)</span> via DERP<span class=o>(</span>home<span class=o>)</span> in 45ms
</span></span><span class=line><span class=cl>pong from oneplus-8t <span class=o>(</span>10.1.0.8<span class=o>)</span> via DERP<span class=o>(</span>home<span class=o>)</span> in 30ms
</span></span></code></pre></div><p>完美！这里的 home 当然是我的家庭宽带，部署方式与上面所说的国内云主机类似，你需要额外开启公网的端口映射（12345/tcp, 3478/udp）。还有一点需要注意的是配置内容：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Regions&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;901&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;RegionID&#34;</span><span class=p>:</span> <span class=mi>901</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;RegionCode&#34;</span><span class=p>:</span> <span class=s2>&#34;ali-sh&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;RegionName&#34;</span><span class=p>:</span> <span class=s2>&#34;Aliyun Shanghai&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Nodes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;Name&#34;</span><span class=p>:</span> <span class=s2>&#34;901a&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;RegionID&#34;</span><span class=p>:</span> <span class=mi>901</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;DERPPort&#34;</span><span class=p>:</span> <span class=mi>443</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;HostName&#34;</span><span class=p>:</span> <span class=s2>&#34;xxxx&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;IPv4&#34;</span><span class=p>:</span> <span class=s2>&#34;xxxx&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;InsecureForTests&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;902&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;RegionID&#34;</span><span class=p>:</span> <span class=mi>902</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;RegionCode&#34;</span><span class=p>:</span> <span class=s2>&#34;home&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;RegionName&#34;</span><span class=p>:</span> <span class=s2>&#34;Home Hangzhou&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Nodes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;Name&#34;</span><span class=p>:</span> <span class=s2>&#34;902a&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;RegionID&#34;</span><span class=p>:</span> <span class=mi>902</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;DERPPort&#34;</span><span class=p>:</span> <span class=mi>12345</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;HostName&#34;</span><span class=p>:</span> <span class=s2>&#34;xxxx&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;InsecureForTests&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>与国内云主机相比，家庭宽带的配置有两点不同：</p><ul><li>需要删除 <code>IPv4</code> 配置项。因为家用宽带的公网 IP 是动态变化的，所以你需要使用 <strong>DDNS</strong> 来动态解析公网 IP。</li><li><code>HostName</code> 最好填域名，因为你的公网 IP 是动态变化的，没法填写 IP，除非你不停地修改配置文件。填域名也没关系啦，反正不会验证域名的，也不用关心证书的事情，<strong>只要域名能解析到你的公网 IP 即可。</strong></li></ul><h2 class="relative group">防止 DERP 被白嫖<div id=%E9%98%B2%E6%AD%A2-derp-%E8%A2%AB%E7%99%BD%E5%AB%96 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E9%98%B2%E6%AD%A2-derp-%E8%A2%AB%E7%99%BD%E5%AB%96 aria-label=锚点>#</a></span></h2><p>默认情况下 DERP 服务器是可以被白嫖的，只要别人知道了你的 DERP 服务器的地址和端口，就可以为他所用。如果你的服务器是个小水管，用的人多了可能会把你撑爆，因此我们需要修改配置来防止被白嫖。</p><blockquote><p>特别声明：只有使用域名的方式才可以通过认证防止被白嫖，使用纯 IP 的方式无法防白嫖，你只能小心翼翼地隐藏好你的 IP 和端口，不能让别人知道。</p></blockquote><p>只需要做两件事情：</p><p><strong>1、在 DERP 服务器上安装 Tailscale。</strong></p><p>第一步需要在 DERP 服务所在的主机上安装 Tailscale 客户端，<strong>启动 tailscaled 进程</strong>。</p><p><strong>2、derper 启动时加上参数 <code>--verify-clients</code>。</strong></p><p>本文推荐的是通过容器启动，
<a href="https://icloudnative.io/go/?target=aHR0cHM6Ly9naXRodWIuY29tL3lhbmdjaHVhbnNoZW5nL2RvY2tlci1pbWFnZS9ibG9iL21hc3Rlci9kZXJwZXIvRG9ja2VyZmlsZQ%3d%3d" target=_blank>Dockerfile 内容</a>如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> golang:latest AS builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>LABEL</span> org.opencontainers.image.source https://github.com/yangchuansheng/docker-image<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># https://tailscale.com/kb/1118/custom-derp-servers/</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> go install tailscale.com/cmd/derper@main<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> ubuntu</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>DEBIAN_FRONTEND</span><span class=o>=</span>noninteractive
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    apt-get install -y --no-install-recommends apt-utils <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    apt-get install -y ca-certificates <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    mkdir /app/certs<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> DERP_DOMAIN your-hostname.com<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> DERP_CERT_MODE letsencrypt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> DERP_CERT_DIR /app/certs<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> DERP_ADDR :443<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> DERP_STUN true<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> DERP_HTTP_PORT <span class=m>80</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> DERP_VERIFY_CLIENTS false<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /go/bin/derper .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> /app/derper --hostname<span class=o>=</span><span class=nv>$DERP_DOMAIN</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --certmode<span class=o>=</span><span class=nv>$DERP_CERT_MODE</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --certdir<span class=o>=</span><span class=nv>$DERP_CERT_DIR</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --a<span class=o>=</span><span class=nv>$DERP_ADDR</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --stun<span class=o>=</span><span class=nv>$DERP_STUN</span>  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --http-port<span class=o>=</span><span class=nv>$DERP_HTTP_PORT</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --verify-clients<span class=o>=</span><span class=nv>$DERP_VERIFY_CLIENTS</span><span class=err>
</span></span></span></code></pre></div><p>默认情况下 <code>--verify-clients</code> 参数设置的是 <code>false</code>。我们不需要对 Dockerfile 内容做任何改动，只需在容器启动时加上环境变量即可，将之前的启动命令修改一下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>🐳  → docker run --restart always <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --name derper -p 12345:12345 -p 3478:3478/udp <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v /root/.acme.sh/xxxx/:/app/certs <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>DERP_CERT_MODE</span><span class=o>=</span>manual <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>DERP_ADDR</span><span class=o>=</span>:12345 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>DERP_DOMAIN</span><span class=o>=</span>xxxx <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>DERP_VERIFY_CLIENTS</span><span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -d ghcr.io/yangchuansheng/derper:latest
</span></span></code></pre></div><p>这样就大功告成了，别人即使知道了你的 DERP 服务器地址也无法使用，但还是要说明一点，即便如此，你也应该尽量不让别人知道你的服务器地址，防止别人有可趁之机。</p><h2 class="relative group">总结<div id=%E6%80%BB%E7%BB%93 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E6%80%BB%E7%BB%93 aria-label=锚点>#</a></span></h2><p>本文给大家介绍了 STUN 对于辅助 NAT 穿透的意义，科普了几种常见的中继协议，包含 Tailscale 自研的 DERP 协议。最后手把手教大家如何自建私有的 DERP 服务器，并让 Tailscale 使用我们自建的 DERP 服务器。</p><h2 class="relative group">参考资料<div id=%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99 aria-label=锚点>#</a></span></h2><ul><li><a href="https://icloudnative.io/go/?target=aHR0cHM6Ly9hcnRodXJjaGlhby5hcnQvYmxvZy9ob3ctbmF0LXRyYXZlcnNhbC13b3Jrcy16aC8%3d" target=_blank>NAT 穿透是如何工作的：技术原理及企业级实践</a></li><li><a href="https://icloudnative.io/go/?target=aHR0cHM6Ly90YWlsc2NhbGUuY29tL2tiLzExMTgvY3VzdG9tLWRlcnAtc2VydmVycy8%3d" target=_blank>Custom DERP Servers</a></li><li><a href="https://icloudnative.io/go/?target=aHR0cHM6Ly90YWlsc2NhbGUuY29tL2Jsb2cvaG93LXRhaWxzY2FsZS13b3Jrcy8jZW5jcnlwdGVkLXRjcC1yZWxheXMtZGVycA%3d%3d" target=_blank>Encrypted TCP relays (DERP)</a></li></ul></div><details style=margin-left:0 class="mt-2 mb-5 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 max-w-prose"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">Tailscale 系列教程 - 本文属于系列文章之一</summary><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=https://icloudnative.io/posts/tailscale-acls/>Part : Tailscale/Headscale ACL 使用教程</a></div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">Part : 本文</div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=https://icloudnative.io/posts/how-to-set-up-or-migrate-headscale/>Part : Tailscale 基础教程：Headscale 的部署方法和使用教程</a></div></details><div class="text-neutral-700 dark:text-neutral-300" style=text-align:center;font-size:16px;font-family:cursive>-------他日江湖相逢
<span class="relative icon" style=display:inline-block><svg version="1.0" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="800" height="800" viewBox="0 0 64 64" enable-background="new 0 0 64 64"><g><path fill="#394240" d="M35 4.145V3.002 3c0-1.656-1.343-3-3-3s-3 1.344-3 3v.002 1.143C12.734 5.658.0 19.338.0 36c0 0 0 1 1 1s1.867-1 1.867-1C4.68 34.15 7.204 33 10 33c4.1.0 7.618 2.469 9.162 6 0 0 .541 1 1.838 1s1.838-1 1.838-1c1.15-2.629 3.396-4.668 6.162-5.539V56c0 4.418 3.582 8 8 8s8-3.582 8-8c0-1.656-1.343-3-3-3s-3 1.344-3 3c0 1.104-.896 2-2 2s-2-.896-2-2V33.461c2.766.871 5.012 2.91 6.162 5.539.0.0.541 1 1.838 1s1.838-1 1.838-1c1.544-3.531 5.062-6 9.162-6 2.796.0 5.319 1.15 7.133 3 0 0 .867 1 1.867 1s1-1 1-1C64 19.338 51.266 5.658 35 4.145zM31 3c0-.553.447-1 1-1s1 .447 1 1v1.025C32.667 4.016 32.335 4 32 4s-.667.016-1 .025V3zM10 31c-3.047.0-5.816 1.145-7.928 3.018C3.006 19.729 13.94 8.17 27.947 6.277 22.911 14.678 20 24.492 20 35v1.387C17.853 33.145 14.181 31 10 31zM37 60c2.209.0 4-1.791 4-4 0-.553.447-1 1-1s1 .447 1 1c0 3.312-2.687 6-6 6s-6-2.688-6-6V33.055C31.329 33.023 31.662 33 32 33s.671.023 1 .055V56c0 2.209 1.791 4 4 4zM32 31c-4.181.0-7.853 2.145-10 5.387V35c0-10.662 3.113-20.588 8.449-28.959.5-.025 1.004-.039 1.511-.039h.08c.507.0 1.011.014 1.511.039C38.887 14.412 42 24.338 42 35v1.387C39.853 33.145 36.181 31 32 31zm22 0c-4.181.0-7.853 2.145-10 5.387V35c0-10.508-2.911-20.322-7.947-28.723C50.06 8.17 60.994 19.729 61.928 34.018 59.816 32.145 57.047 31 54 31z"/><path fill="#f9ebb2" d="M31 3c0-.553.447-1 1-1s1 .447 1 1v1.025C32.667 4.016 32.335 4 32 4s-.667.016-1 .025V3z"/><g><path fill="#45aab8" d="M2.072 34.018C4.184 32.145 6.953 31 10 31c4.181.0 7.853 2.145 10 5.387V35c0-10.508 2.911-20.322 7.947-28.723C13.94 8.17 3.006 19.729 2.072 34.018z"/><path fill="#45aab8" d="M36.053 6.277C41.089 14.678 44 24.492 44 35v1.387C46.147 33.145 49.819 31 54 31c3.047.0 5.816 1.145 7.928 3.018C60.994 19.729 50.06 8.17 36.053 6.277z"/></g><path fill="#b4ccb9" d="M32.04 6.002h-.08c-.507.0-1.011.014-1.511.039C25.113 14.412 22 24.338 22 35v1.387C24.147 33.145 27.819 31 32 31s7.853 2.145 10 5.387V35c0-10.662-3.113-20.588-8.449-28.959C33.051 6.016 32.547 6.002 32.04 6.002z"/><path fill="#f9ebb2" d="M37 60c2.209.0 4-1.791 4-4 0-.553.447-1 1-1s1 .447 1 1c0 3.312-2.687 6-6 6s-6-2.688-6-6V33.055C31.329 33.023 31.662 33 32 33s.671.023 1 .055V56c0 2.209 1.791 4 4 4z"/></g></svg></span>再当杯酒言欢-------</div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://icloudnative.io/posts/custom-derp-servers/&amp;title=Tailscale%20%e5%9f%ba%e7%a1%80%e6%95%99%e7%a8%8b%ef%bc%9a%e9%83%a8%e7%bd%b2%e7%a7%81%e6%9c%89%20DERP%20%e4%b8%ad%e7%bb%a7%e6%9c%8d%e5%8a%a1%e5%99%a8" title="分享到 LinkedIn" aria-label="分享到 LinkedIn"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://icloudnative.io/posts/custom-derp-servers/&amp;text=Tailscale%20%e5%9f%ba%e7%a1%80%e6%95%99%e7%a8%8b%ef%bc%9a%e9%83%a8%e7%bd%b2%e7%a7%81%e6%9c%89%20DERP%20%e4%b8%ad%e7%bb%a7%e6%9c%8d%e5%8a%a1%e5%99%a8" title="分享到 Twitter" aria-label="分享到 Twitter"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://icloudnative.io/posts/custom-derp-servers/&amp;resubmit=true&amp;title=Tailscale%20%e5%9f%ba%e7%a1%80%e6%95%99%e7%a8%8b%ef%bc%9a%e9%83%a8%e7%bd%b2%e7%a7%81%e6%9c%89%20DERP%20%e4%b8%ad%e7%bb%a7%e6%9c%8d%e5%8a%a1%e5%99%a8" title="提交到 Reddit" aria-label="提交到 Reddit"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://icloudnative.io/posts/custom-derp-servers/&amp;resubmit=true&amp;title=Tailscale%20%e5%9f%ba%e7%a1%80%e6%95%99%e7%a8%8b%ef%bc%9a%e9%83%a8%e7%bd%b2%e7%a7%81%e6%9c%89%20DERP%20%e4%b8%ad%e7%bb%a7%e6%9c%8d%e5%8a%a1%e5%99%a8" title="分享到 WhatsApp" aria-label="分享到 WhatsApp"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://t.me/share/url?url=https://icloudnative.io/posts/custom-derp-servers/&amp;resubmit=true&amp;title=Tailscale%20%e5%9f%ba%e7%a1%80%e6%95%99%e7%a8%8b%ef%bc%9a%e9%83%a8%e7%bd%b2%e7%a7%81%e6%9c%89%20DERP%20%e4%b8%ad%e7%bb%a7%e6%9c%8d%e5%8a%a1%e5%99%a8" title="分享到 Telegram" aria-label="分享到 Telegram"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://icloudnative.io/posts/custom-derp-servers/&amp;description=Tailscale%20%e5%9f%ba%e7%a1%80%e6%95%99%e7%a8%8b%ef%bc%9a%e9%83%a8%e7%bd%b2%e7%a7%81%e6%9c%89%20DERP%20%e4%b8%ad%e7%bb%a7%e6%9c%8d%e5%8a%a1%e5%99%a8" title="钉到 Pinterest" aria-label="钉到 Pinterest"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://icloudnative.io/posts/custom-derp-servers/&amp;quote=Tailscale%20%e5%9f%ba%e7%a1%80%e6%95%99%e7%a8%8b%ef%bc%9a%e9%83%a8%e7%bd%b2%e7%a7%81%e6%9c%89%20DERP%20%e4%b8%ad%e7%bb%a7%e6%9c%8d%e5%8a%a1%e5%99%a8" title="分享到 Facebook" aria-label="分享到 Facebook"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://icloudnative.io/posts/custom-derp-servers/&amp;subject=Tailscale%20%e5%9f%ba%e7%a1%80%e6%95%99%e7%a8%8b%ef%bc%9a%e9%83%a8%e7%bd%b2%e7%a7%81%e6%9c%89%20DERP%20%e4%b8%ad%e7%bb%a7%e6%9c%8d%e5%8a%a1%e5%99%a8" title=通过电子邮件发送 aria-label=通过电子邮件发送><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></section><h2 class="mt-8 text-2xl font-extrabold mb-10">相关文章</h2><section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3"><a href=/posts/how-to-set-up-or-migrate-headscale/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="w-full thumbnail_card_related nozoom" data-bg=/posts/how-to-set-up-or-migrate-headscale/featured_hu6420e54fb45e72938bc85181a5d4d7a0_157784_600x0_resize_q75_box.jpg></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/posts/how-to-set-up-or-migrate-headscale/>Tailscale 基础教程：Headscale 的部署方法和使用教程</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-03-21 09:06:37 +0800 +0800">2022年3月21日</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2023-12-29 18:01:37 +0800 +0800">更新于: 2023年12月29日</time><span class="px-2 text-primary-500">&#183;</span><span>6530 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>14 分钟</span><span class="px-2 text-primary-500">&#183;</span><span>
<span id=busuanzi_page_pv></span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span></span></div><div class="flex flex-row flex-wrap items-center"></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/network/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">网络
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/vpn/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">VPN
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/wireguard/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">WireGuard
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/tailscale/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Tailscale
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/headscale/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Headscale</span></span></span></div></div></div><div class="px-6 pt-4 pb-2"></div></div></a><a href=/posts/configure-a-mesh-network-with-netmaker-2/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="w-full thumbnail_card_related nozoom" data-bg=/posts/configure-a-mesh-network-with-netmaker-2/featured_hu7dfe7dd432a0e380ac6d1ef747c52963_111829_600x0_resize_q75_box.jpg></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/posts/configure-a-mesh-network-with-netmaker-2/>WireGuard 教程：使用 Netmaker 配置 WireGuard 全互联 (full mesh) 模式</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2021-11-09 19:06:37 +0800 +0800">2021年11月9日</time><span class="px-2 text-primary-500">&#183;</span><span>3663 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>8 分钟</span><span class="px-2 text-primary-500">&#183;</span><span>
<span id=busuanzi_page_pv></span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span></span></div><div class="flex flex-row flex-wrap items-center"></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/network/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">网络
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/vpn/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">VPN
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/wireguard/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">WireGuard
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/linux/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Linux
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/netmaker/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Netmaker
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/kubernetes/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Kubernetes</span></span></span></div></div></div><div class="px-6 pt-4 pb-2"></div></div></a><a href=/posts/configure-a-mesh-network-with-netmaker/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="w-full thumbnail_card_related nozoom" data-bg=/posts/configure-a-mesh-network-with-netmaker/featured_hu482256601f47db8fd15419cfa31d8202_3060_600x0_resize_q75_box.jpg></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/posts/configure-a-mesh-network-with-netmaker/>WireGuard 教程：使用 Netmaker 来管理 WireGuard 的配置</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2021-10-18 19:06:37 +0800 +0800">2021年10月18日</time><span class="px-2 text-primary-500">&#183;</span><span>3490 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>7 分钟</span><span class="px-2 text-primary-500">&#183;</span><span>
<span id=busuanzi_page_pv></span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span></span></div><div class="flex flex-row flex-wrap items-center"></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/network/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">网络
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/vpn/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">VPN
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/wireguard/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">WireGuard
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/linux/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Linux
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/netmaker/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Netmaker
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/kubernetes/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Kubernetes</span></span></span></div></div></div><div class="px-6 pt-4 pb-2"></div></div></a><a href=/posts/wireguard-docs-practice/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="w-full thumbnail_card_related nozoom" data-bg=/posts/wireguard-docs-practice/featured_hu762c5e430bd8288fae025947e726b9c8_5420_600x0_resize_q75_box.jpg></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/posts/wireguard-docs-practice/>WireGuard 教程：WireGuard 的搭建使用与配置详解</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2020-07-06 15:53:49 +0800 +0800">2020年7月6日</time><span class="px-2 text-primary-500">&#183;</span><span>6947 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>14 分钟</span><span class="px-2 text-primary-500">&#183;</span><span>
<span id=busuanzi_page_pv></span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span></span></div><div class="flex flex-row flex-wrap items-center"></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/network/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">网络
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/vpn/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">VPN
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/wireguard/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">WireGuard</span></span></span></div></div></div><div class="px-6 pt-4 pb-2"></div></div></a><a href=/posts/wireguard-docs-theory/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="w-full thumbnail_card_related nozoom" data-bg=/posts/wireguard-docs-theory/featured_hu2f6a85831f4704c09173ebce29d4819e_81180_600x0_resize_q75_box.jpg></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/posts/wireguard-docs-theory/>WireGuard 教程：WireGuard 的工作原理</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2020-07-01 11:18:32 +0800 +0800">2020年7月1日</time><span class="px-2 text-primary-500">&#183;</span><span>3641 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>8 分钟</span><span class="px-2 text-primary-500">&#183;</span><span>
<span id=busuanzi_page_pv></span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span></span></div><div class="flex flex-row flex-wrap items-center"></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/network/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">网络
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/vpn/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">VPN
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/wireguard/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">WireGuard</span></span></span></div></div></div><div class="px-6 pt-4 pb-2"></div></div></a><a href=/posts/wireguard-endpoint-discovery-nat-traversal/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="w-full thumbnail_card_related nozoom" data-bg=/posts/wireguard-endpoint-discovery-nat-traversal/featured_hu5e82f6e810ac2abcd807c9ae52d0d669_4315_600x0_resize_q75_box.jpg></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/posts/wireguard-endpoint-discovery-nat-traversal/>WireGuard 教程：使用 DNS-SD 进行 NAT-to-NAT 穿透</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2021-01-28 16:41:34 +0800 +0800">2021年1月28日</time><span class="px-2 text-primary-500">&#183;</span><span>6312 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>13 分钟</span><span class="px-2 text-primary-500">&#183;</span><span>
<span id=busuanzi_page_pv></span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span></span></div><div class="flex flex-row flex-wrap items-center"></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/network/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">网络
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/wireguard/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">WireGuard</span></span></span></div></div></div><div class="px-6 pt-4 pb-2"></div></div></a></section></div><script>var oid="views_posts/custom-derp-servers/index.md",oid_likes="likes_posts/custom-derp-servers/index.md"</script><script type=text/javascript src=/js/page.min.b06a29d42a4ed16787978e2eee1e8c797b7698db2bc14ccee78f5c80ac566fc996190a73ad80a5e987558474b20b96fa38f7d85b405f165ff72b7b163c5ad11b.js integrity="sha512-sGop1CpO0WeHl44u7h6MeXt2mNsrwUzO549cgKxWb8mWGQpzrYCl6YdVhHSyC5b6OPfYW0BfFl/3K3sWPFrRGw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/how-to-set-up-or-migrate-headscale/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Tailscale 基础教程：Headscale 的部署方法和使用教程</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-03-21 09:06:37 +0800 +0800">2022年3月21日</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/posts/cloud-native-podcasts/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">云原生领域 Podcast 推荐大全</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-04-09 09:06:37 +0800 +0800">2022年4月9日</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><script type=text/javascript>var lazyadsense=!1;window.addEventListener("scroll",function(){(0!=document.documentElement.scrollTop&&!1===lazyadsense||0!=document.body.scrollTop&&!1===lazyadsense)&&(!function(){var t,e=document.createElement("script");e.id="g_ads_js",e.type="text/javascript",e.async="async",e.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3925981084585036",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}(),lazyadsense=!0)},!0)</script><script>(adsbygoogle=window.adsbygoogle||[]).onload=function(){[].forEach.call(document.getElementsByClassName("adsbygoogle"),function(){adsbygoogle.push({})})}</script><div style="min-height=250px"><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-3925981084585036 data-ad-slot=4806125422 data-ad-format=auto data-full-width-responsive=true></ins></div><img style=margin-top:1.5em loading=lazy src=/img/wechat-qr.webp alt=公众号二维码><div id=comment></div><script>document.addEventListener("DOMContentLoaded",function(){var t="/js/iDisqus.min.js",e=new IntersectionObserver(function(n){if(n[0].isIntersecting){var s,o=document.createElement("link");o.rel="stylesheet",o.href="/css/iDisqus.min.css",document.head.appendChild(o),s=document.createElement("script"),s.src=t,s.onload=function(){var e=new iDisqus("comment",{forum:"fuckcloudnative",api:"https://disqus.icloudnative.io",site:"https://icloudnative.io",emojiPath:"https://images.icloudnative.io/emoji/",mode:2,timeout:15,init:!0})},document.body.appendChild(s),e.disconnect()}},{threshold:[.1]});e.observe(document.getElementById("comment"))})</script></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label=返回顶部 title=返回顶部>&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden" style=margin-inline:auto;text-align:center><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/tags/ title=标签>标签</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/categories/ title=分类>分类</a></li></ul></nav><div class="flex items-center justify-between"></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.62060bb247f4de2b6dde45903668fefb68d792f365587605177b1227c0cf43588701edaca0cb40e2c8e2789bd5ce67c1d2a215b9fb258c3496a7cd25e7cb5fdf.js integrity="sha512-YgYLskf03itt3kWQNmj++2jXkvNlWHYFF3sSJ8DPQ1iHAe2soMtA4sjieJvVzmfB0qIVufsljDSWp80l58tf3w=="></script><div class=busuanzi style=margin-inline:auto;text-align:center><div class=busuanzi__item><span class="busuanzi__item--label text-neutral-500 dark:text-neutral-400">总访客</span>
<span id=busuanzi_site_uv class="busuanzi__item--number text-neutral-500 dark:text-neutral-400"></span></div><div class=busuanzi__item><span class="busuanzi__item--label text-neutral-500 dark:text-neutral-400">总浏览量</span>
<span id=busuanzi_site_pv class="busuanzi__item--number text-neutral-500 dark:text-neutral-400"></span></div></div><p class="text-sm text-neutral-500 dark:text-neutral-400" style=margin-inline:auto;text-align:center>&copy; 2024 米开朗基杨<br>本站内容依据
<a href=https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh target=_blank>CC BY-SA 4.0</a>
许可证进行授权，转载请附上出处链接。</p><div class=github-badge><span class=badge-subject>构建工具</span><span class="badge-value bg-blue"><a style=color:#fff href=https://gohugo.io/ target=_blank>Hugo v0.120.4</a></span>
<span class=badge-subject>托管于</span><span class="badge-value bg-brightgreen"><a style=color:#fff href=https://sealos.run target=_blank>Sealos</a></span>
<span class=badge-subject>CDN</span><span class="badge-value bg-blueviolet"><a style=color:#fff href=https://vercel.com target=_blank>Vercel</a></span>
<span class=badge-subject>图床</span><span class="badge-value bg-orange"><a style=color:#fff href=https://www.jsdelivr.com/ target=_blank>jsDelivr</a></span>
<span class=badge-subject>主题</span><span class="badge-value bg-blue"><a style=color:#fff href=https://github.com/nunocoracao/blowfish target=_blank>Blowfish</a></span></div><section class="text-sm text-neutral-500 dark:text-neutral-400"><span id=span_dt_dt></span><script defer language=javascript>var uptime_1="本站已经开心运行 ",uptime_2=" 天 ",uptime_3=" 小时 ",uptime_4=" 分 ",uptime_5=" 秒";function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("10/8/2019 10:56:12"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=24*60*60*1e3,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=(e_daysold-daysold)*24,hrsold=Math.floor(e_hrsold),e_minsold=(e_hrsold-hrsold)*60,minsold=Math.floor((e_hrsold-hrsold)*60),seconds=Math.floor((e_minsold-minsold)*60),span_dt_dt.innerHTML=uptime_1+daysold+uptime_2+hrsold+uptime_3+minsold+uptime_4+seconds+uptime_5}show_date_time()</script></section><style>.wxtip{background:rgba(0,0,0,.8);text-align:center;position:fixed;left:0;top:0;width:100%;height:100%;z-index:998;display:none}.wxtip-icon{width:52px;height:67px;background:url(img/weixin-tip.png)no-repeat;display:block;position:absolute;right:20px;top:20px}.wxtip-txt{margin-top:107px;color:#fff;font-size:16px;line-height:1.5}</style><div class=wxtip id=JweixinTip><span class=wxtip-icon></span><p class=wxtip-txt>点击屏幕右上角的 ···<br>在弹出的窗口中选择 <span style=color:red>在浏览器中打开</span></p><br><br><p><img loading=lazy style=width:85%;border-radius:10px;display:block;margin-left:auto;margin-right:auto src=/img/wechat-browser.jpg></p></div><script defer>is_weixn_qq()&&(document.getElementById("JweixinTip").style.display="block",document.getElementById("container").style.display="none",document.getElementById("top-grrk").style.display="none");function is_weixn_qq(){var e=navigator.userAgent,t=!!/MicroMessenger/i.test(e),n=!!/QQ\//i.test(e);return!!(t||n)}</script><div id=fixed-box><div class=feedback-btn-wrapper><a data-umami-event=FastGPT href=https://github.com/labring/FastGPT style=text-decoration:none target=_blank><button id=feedback-btn title=FastGPT>
<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 640 512" fill="currentcolor"><path d="M320 0c17.7.0 32 14.3 32 32V96H472c39.8.0 72 32.2 72 72V440c0 39.8-32.2 72-72 72H168c-39.8.0-72-32.2-72-72V168c0-39.8 32.2-72 72-72H288V32c0-17.7 14.3-32 32-32zM208 384c-8.8.0-16 7.2-16 16s7.2 16 16 16h32c8.8.0 16-7.2 16-16s-7.2-16-16-16H208zm96 0c-8.8.0-16 7.2-16 16s7.2 16 16 16h32c8.8.0 16-7.2 16-16s-7.2-16-16-16H304zm96 0c-8.8.0-16 7.2-16 16s7.2 16 16 16h32c8.8.0 16-7.2 16-16s-7.2-16-16-16H4e2zM264 256a40 40 0 10-80 0 40 40 0 1080 0zm152 40a40 40 0 100-80 40 40 0 100 80zM48 224H64V416H48c-26.5.0-48-21.5-48-48V272c0-26.5 21.5-48 48-48zm544 0c26.5.0 48 21.5 48 48v96c0 26.5-21.5 48-48 48H576V224h16z"/></svg><span _msttexthash=6039839 _msthash=295>AI 客服</span></button></a></div></div><script defer src=https://wvprxbiaqrgp.hzh.sealos.run/js></script><script>document.addEventListener("DOMContentLoaded",function(){const s=document.getElementById("busuanzi_site_uv"),o=document.getElementById("busuanzi_site_pv"),e=new MutationObserver(t=>{for(let n of t)if(n.type==="childList"){e.disconnect(),n.target.innerHTML=parseInt(n.target.innerHTML)+731632;break}}),t=new MutationObserver(e=>{for(let n of e)if(n.type==="childList"){t.disconnect(),n.target.innerHTML=parseInt(n.target.innerHTML)+1360325;break}}),n={childList:!0};e.observe(s,n),t.observe(o,n)})</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",e=>{var n=["Docker","Kubernetes","Prometheus","Sealos","FastGPT","Envoy","eBPF","Laf","Webassembly","WireGuard","Tailscale","Cloud Native"],t=0;document.body.addEventListener("click",function(e){var s,o,i,a,r,l=n[t];t=(t+1)%n.length,s=document.createElement("span"),s.textContent=l,s.style.cssText=`
            z-index: 9999;
            top: ${e.pageY-20}px;
            left: ${e.pageX}px;
            position: absolute;
            font-weight: bold;
            color: ${randomColor()};
            opacity: 1;
            transition: opacity 1.5s;
        `,document.body.appendChild(s),o=null,a=1500,i=e.pageY-20,r=i-160;function c(e){o===null&&(o=e);var t=(e-o)/a;t<1?(s.style.top=i-t*(i-r)+"px",requestAnimationFrame(c)):s.remove()}requestAnimationFrame(c)})});function randomColor(){var e=["#FFDA65","#00BFFF","#cb80ff","#acc2ef","#87CEEB","#FFB6C1"];return e[Math.floor(Math.random()*e.length)]}</script><script>document.addEventListener("DOMContentLoaded",function(){var e=function(e,t){e.forEach(function(e){if(e.isIntersecting){var n=e.target,s=n.getAttribute("data-bg");n.style.backgroundImage="url('"+s+"')",t.unobserve(e.target)}})},t=new IntersectionObserver(e),n=document.querySelectorAll(".thumbnail_card_related, .thumbnail_card");n.forEach(function(e){t.observe(e)})})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://icloudnative.io style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=搜索 tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="关闭 (Esc)">
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div><div class="bg fixed top-0 left-0 h-screen w-screen"></div></body></html>